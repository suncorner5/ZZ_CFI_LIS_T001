REPORT ZZ_CFI_LIS_T001 MESSAGE-ID FR.

 

* Datendeklaration.

TABLES: ARCH_IDX, ARC_BUFFER.                              "PBSW181002

DATA: ABDATM_FLG(1) TYPE C.                                "PBSW181002

DATA: ARCH_SEL(1) TYPE C.                                  "PBSW181002

TYPE-POOLS: SLIS.

 

data: address_selection like addr1_sel.

data: address_value     like addr1_val.

tables: sadr.

 

* Anfang                                                   "PBSW231003

*DATA: BEGIN OF ABAP_TAB OCCURS 0,                         "PBSW060417

*         LINE(72),                                        "PBSW060417

*       END OF ABAP_TAB.                                   "PBSW060417

data: abap_tab type table of string with header line.      "PBSW060417

 

 

* Ende                                                     "PBSW231003

 

 

*DATA:  REFTAB LIKE DD02L-TABNAME.                         "PBSW100602

 

DATA: COLOR_WA    TYPE SLIS_SPECIALCOL_ALV,

      EVENTS_WA   TYPE SLIS_ALV_EVENT,

      EVENTS      TYPE SLIS_T_EVENT,

      FIELDCAT_WA TYPE SLIS_FIELDCAT_ALV,

      FIELDCAT    TYPE SLIS_T_FIELDCAT_ALV,

      FIELDCAT_T  TYPE SLIS_T_FIELDCAT_ALV,

      IT_EVENT_EXIT_WA TYPE SLIS_EVENT_EXIT,

      IT_EVENT_EXIT TYPE SLIS_EVENT_EXIT OCCURS 1,

      LAYOUT      TYPE SLIS_LAYOUT_ALV,

      GS_KEYINFO  TYPE SLIS_KEYINFO_ALV,

      GS_PRINT    TYPE SLIS_PRINT_ALV,

      VARIANT     LIKE DISVARIANT,

      TABNAME     TYPE SLIS_TABNAME.

DATA: P_STOP(1)   TYPE C,

      N_LINES     LIKE SY-TABIX,

      OKAY        TYPE C VALUE SPACE.

 

 

DATA: TERRINF LIKE ACERRLOG OCCURS 0 WITH HEADER LINE.

 

DATA: BEGIN OF S_STATUS,

        WAEHR,                         "F = FW, H = HW, 2 = 2.HW, 3=3.HW

        BUPER(1)    TYPE C,            "X = Buper noch offen

      END OF S_STATUS.

 

DATA:   XOPAR(1)     TYPE C,           "Soll Beleg ins opt.Archiv

        XWFLA(1)     TYPE C,           "Workflow active

        G_AKTYP      LIKE T020-AKTYP,  "activity type: change/displ

        G_EXIT(1)    TYPE C,           "Exit from 'New Document'

        G_UCOMM      LIKE SY-UCOMM.

 

DATA: XLINE.

 

* Ausgabestruktur

* Ausgabestruktur

INCLUDE /PBS/CFI_LIS_T001_STRU.

*INCLUDE /PBS/CFI_LIS_REFERENCE_STRU.

*INCLUDE /PBS/CFI_LIS_AIS_T009_STRU.

*INCLUDE /PBS/CFI_LIS_REFERENCE_STRU.

 

 

DATA:    BEGIN OF TABBEZ OCCURS 10,

           BUKRS         LIKE BKPF-BUKRS,

           BELNR         LIKE BKPF-BELNR,

           BUZEI(3)      TYPE C,

           HKBEZ         LIKE BSEGL-HKBEZ,

           KTOBK(30)     TYPE C,

           KTOBL(50)     TYPE C,

           KONTO(10)     TYPE C,

           AUTHO(1)      TYPE C,

           EGMLD         LIKE RF05L-EGMLD,

         END OF TABBEZ.

 

 

DATA: ARCHBSEG LIKE BSEG OCCURS 0 WITH HEADER LINE.

 

 

DATA: TACCDN TYPE TABLE OF ACCDN WITH HEADER LINE.

DATA: I_LENGTH  TYPE I.

DATA: XTABCOUNT TYPE I.

DATA: XTEXT LIKE SYST-TITLE.

* table for document items that cannot be displayed because of

* missing authority:

DATA: BEGIN OF GT_MISSING_AUTH OCCURS 0,

        BUKRS LIKE BSEG-BUKRS,

        BELNR LIKE BSEG-BELNR,

        DASH,

        BUZEI LIKE BSEG-BUZEI,

        SEMICOLON,

      END OF GT_MISSING_AUTH.

 

DATA: ANZST(40),

*      BEGRU        LIKE SKB1-BEGRU,                     "PBSW211002

      DATE         LIKE BKPF-BUDAT,

      INDEX        LIKE SY-TABIX,

      OK-CODE(5)   TYPE C,             "OK Code (Funktionscode)

      XFELD,

      COMREQ(1),                       "Commitrequest

      FRPE1        LIKE T001B-FRPE1,   "Monat dreistellig

      XBMODZ(1)    TYPE C,             "Zeile aenderbar ?

      DDTEXT       LIKE DD07T-DDTEXT,

      DOMVALUE     LIKE DD07L-DOMVALUE_L,

      EPOS,                            "Ruf aus Einzelpostenanzeige

      RCODE        LIKE SY-SUBRC,

*      TCODE        LIKE SY-TCODE,                       "PBSW091002

      OKCODE(5),                       "OKCODE to pass to caller

      OLD_BKTXT    LIKE BKPF-BKTXT,

      OLD_XBLNR    LIKE BKPF-XBLNR,

      STATUS(1),                       " 'L'ist, 'H'ierarchische Liste

      VARIANT_FIX,                     "'X': Variante nicht bestimmen

      XCHNG(1),                        " 'X':Es gab Änderungen

      XXREF(1)     TYPE C,             " Suche über Ref.

      XSPIU(1).                        " Benutzeroption aus RFOPT

 

*------- Felder fuer Workflow

DATA:    BEGIN OF WFLKEY,

            BUKRS            LIKE BKPF-BUKRS,

            BELNR            LIKE BKPF-BELNR,

            GJAHR            LIKE BKPF-GJAHR,

         END OF WFLKEY.

 

DATA:    BEGIN OF WFLPOS,

            BUKRS            LIKE BKPF-BUKRS,

            BELNR            LIKE BKPF-BELNR,

            GJAHR            LIKE BKPF-GJAHR,

            BUZEI            LIKE BSEG-BUZEI,

         END OF WFLPOS.

 

 

* Constants

CONSTANTS: C_AKTYP_DISPLAY VALUE 'A',

           C_AKTYP_CHANGE  VALUE 'V',

           C_BEL_VORERF    VALUE 'V',

           C_YES           VALUE 'J',

           C_STAT_LIST     VALUE 'L',

           C_STAT_HIERSEQ  VALUE 'H',

           C_DEBIT         VALUE 'H',

           C_OFF           VALUE '0',

           C_ON            VALUE '1',

           C_A             VALUE 'A',

           C_B             VALUE 'B',

           C_D             VALUE 'D',

           C_H             VALUE 'H',

           C_M             VALUE 'M',

           C_S             VALUE 'S',

           C_U             VALUE 'U',

           C_V             VALUE 'V',

           C_X             VALUE 'X',

           C_Z             VALUE 'Z',

           C_DASH          VALUE '-',

           C_SEMICOLON     VALUE ';'.

  DATA: FIELDCAT_STRU LIKE FIELDCAT

                 WITH HEADER LINE.

  DATA: COLON_BSEG TYPE I.

  DATA: COLON_BKPF TYPE I.

  DATA: L_SAVE(1) TYPE C VALUE C_A.    "Authority to save?

  DATA: TABCOUNT TYPE I.

* Anfang                                                   "PBSC060505

  data: begin of exituser,

         back(1) type c,

         exit(1) type c,

         cancel(1) type c,

       end of exituser.

* Ende                                                     "PBSC060505

********************************************************************

*  Handling Datenextrakt                                           *

********************************************************************

SELECTION-SCREEN BEGIN OF BLOCK TAB WITH FRAME TITLE TEXT-500.

*INCLUDE /PBS/CFI_LIS_T001_SOP

SELECT-OPTIONS : SELOP001 FOR T001-bukrs.

SELECTION-SCREEN END OF BLOCK TAB.

 

 

********************************************************************

*  SELECTION-SCREEN                                                *

*******************************************************************

SELECTION-SCREEN BEGIN OF BLOCK FORMAT WITH FRAME TITLE TEXT-001.

SELECTION-SCREEN BEGIN OF LINE.

    SELECTION-SCREEN POSITION 1.

    PARAMETERS: X_LIST  NO-DISPLAY.

    SELECTION-SCREEN COMMENT 1(15) TEXT-003.

    SELECTION-SCREEN POSITION 20.

    SELECTION-SCREEN COMMENT 20(10) TEXT-004.

    SELECTION-SCREEN POSITION 33.

    PARAMETERS: VARI_LIS TYPE SLIS_VARI.

  SELECTION-SCREEN END OF LINE.

PARAMETERS: PA_NMAX LIKE ITEMSET-NMAX." DEFAULT '1000' .

SELECTION-SCREEN END OF BLOCK FORMAT.

********************************************************************

*  Handling Datenextrakt                                           *

********************************************************************

SELECTION-SCREEN BEGIN OF BLOCK OUTOPT WITH FRAME TITLE TEXT-011.

  PARAMETERS X_ARCH AS CHECKBOX MODIF ID ARC.    "PBSW181002

  PARAMETERS: DISPPRNT RADIOBUTTON GROUP GR1,

              EXP RADIOBUTTON GROUP GR1.

  PARAMETERS: P_CONV RADIOBUTTON GROUP GR1.                "PBSW121104

 

 

 

  SELECTION-SCREEN BEGIN OF BLOCK EXPOPT WITH FRAME TITLE TEXT-012.

    PARAMETERS: DFNAME TYPE CHAR64 LOWER CASE default 'TXW_COMPC',

                DIRNAME TYPE CHAR128

                LOWER CASE MEMORY ID /PBS/CFI_LIS_PATH,

                DESCNAME TYPE CHAR255 LOWER CASE NO-DISPLAY.

* Anfang                                                   "PBSC060505

  SELECTION-SCREEN BEGIN OF LINE.

    PARAMETERS: X_AUTO AS CHECKBOX." DEFAULT 'X'.

    SELECTION-SCREEN COMMENT 3(36) TEXT-033.

  SELECTION-SCREEN END OF LINE.

* Ende                                                     "PBSC060505

*   SELECTION-SCREEN SKIP.

    PARAMETERS AUD NO-DISPLAY.

*    PARAMETERS Aud AS CHECKBOX DEFAULT 'X'.

    INCLUDE /PBS/UTIL_DEI_SOP.                             "PBSC060505

    SELECTION-SCREEN END OF BLOCK EXPOPT.

 

SELECTION-SCREEN END OF BLOCK OUTOPT.

PARAMETERS: ONE_TAB TYPE C NO-DISPLAY.                      "PBSC040707

 

********************************************************************

*  Include zum Datenextrakt                                        *

********************************************************************

*INCLUDE /PBS/CFI_LIS_INC.

*----------------------------------------------------------*

* Copyright by PBS Software GmbH                           *

* Schwanheimer Strasse 144 A                               *

* D-64625 Bensheim                                         *

* Telefon: 49 (0)6251 / 174-0  Fax: 49 (0)6251 / 174-174   *

* Support: hotline@pbs-software.com                        *

*----------------------------------------------------------*

* PBSC101225 enhancement for new TXW_VBRK

* PBSC091024 enhancement for new TXW_COBK

* PBSW150824 Enhancement for TXW_EXTRACT MATBEL

* PBSW040624 Compress content

* PBSM310323 expansion of PBSW251021

* PBSW170522 Pipe sign for belgium extract at and of line.

* PBSW151221 Including reconciliation values for RFBUSU00

* PBSW011121 Switch to textmode (custom development)

* PBSW251021 Authority-Check on FileName

* PBSW141021 Enhancement field size for aggregation values

* PBSW070721 Handling file extension for Extract Austria

* PBSW271120 Enhancement for Auditon SmartAnalyzer

* PBSW040820 Generate XML Description in sub directory if valid

* PBSW230120 Enhancement for BEA Model 1.1

* PBSW041019 Enhancement PBSW250719

* PBSW210819 determine extract language

* PBSW250719 anonymous field content

* PBSW290419 Change MaxSize

* PBSC231018 Add ADR6 fields

* PBSW230418 Add structure PCHIER

* PBSC220218 enhancement PREFIX for TXW_MONITOR

* PBSW120118 Allow prefix for filename

* PBSW061217 Set correct fieldtype for type= e

* PBSW211216 Time lap for open dataset on second attempt

* PBSC260716 enhancement PBSC040316

* PBSW070716 several enhancements for TXW Structures

* PBSW020616 No commit work while transfer header lines

* PBSW010616 Correct decimals for tax related export structures

* PBSC160316 set length for outline

* PBSW160316 Save AIS Structure per file in seprate XML sub path.

* PBSC040316 check file system DIRNAME

* PBSW220116 SET Decimals for local currency

* PBSW060116 Special Field and Table names for DART TXW Files

* PBSW301015 Adapption for HSSM Extract Monitor 2015

* PBSC131015 correct indicator for XVBAP structure

* PBSC250112 correct TGeneratedHeaderType for line-inttype eq 'N'

* PBSC180112 insert NAI structure

* PBSW261011 DART Fieldtext on demand

* PBSV301110 correct lenght for type T

* PBSV300810 corrction of error type P outleng > 16

* PBSC030810 new extract for BSET entries

* PBSW100210 Initialize date and time table to prevent double entries

* PBSW040210 Include for BSET Line

* PBSC180609 Enhance correction PBSW200407

* PBSW230309 Enhance length of outputline

* PBSC300508 correct spool up 6.0

* PBSW300408 Include for field and table structures

* PBSW100408 Export fieldtype C for internal fieldtype T(ime)

* PBSW160108 Set date indepent from user settings

* PBSW020707 Open/End account balance

* PBSW200407 Correct outputlength

* PBSW140307 change length of output line

* PBSW190107 New determination of CRLF

* PBSC110107 Enhancement for one job and more extracts

* PBSW150806 6.0 Version

* PBSW260606 Enhance correction PBSW020606

* PBSW120606 Convert fieldtyp to C ot P for fieldtypes I and F

* PBSW020606 Enhance correction PBSW080506

* PBSW080506 Correction variable file size

* PBSW060406 Variable file size

* PBSW311005 Include for text data

* PBSW220605 Use correct outputlen

* PBSC090605 Enhancement for log+file administration

* PBSW220405 5.0 Version

* PBSW120105 Include for cost center totals

* PBSW181104 Enhancements for unicode systems

* PBSW151104 Correct Message display

* PBSW121104 Support of BW-Extraction

* PBSW071104 Include for material stock data

* PBSW011104 Include for cost center hierarchie

* PBSW230904 Check that display variant have size for display.

* PBSW090804 Correct open file for using under unicode

* PBSW140404 Include for asset history sheet

* PBSW070404 Include for BALANCE

* PBSW040304 Include for Customizing changes

* PBSW120104 Additinal search for decimal value

* PBSW111103 No leading '/' for field extract (Reason audicon TaxAudit)

* PBSW231003 Add textfield for individual extract.

* PBSW180803 Add structure AFVC

* PBSW160603 Set correct decimals

* PBSW240403 System dependent field delimiter and correct CRLF

* PBSW220103 4.7 Version

* PBSW041102 Count exported bytes

* PBSW231002 Include for TTXY

* PBSW211002 Include for CSLA, CEPC, CSKS, CSKA MARA

* PBSW161002 Include for eikp

* PBSW250902 SET correct FIEDTYPE when 'b'.

* PBSW170902 Include for sales structures

* PBSW040902 Include for CFOIS /PAYR items

* PBSW280802 Include for co items

* PBSW210802 Include for purchaseorders

* PBSW130802 Include for master record changes

* PBSW100602 SET Fielddescription when space

***INCLUDE /PBS/CFI_LIS_INC .

********************************************************************

*  Dieser Include beinhaltet die Routinen zum extrahieren  der     *

*  Daten aus den variablen Anzeigeprogrammen                       *

*                                                                  *

********************************************************************

 

********************************************************************

*                                                                  *

*                                                                  *

*                  D a t e n d e k l a r a t i o n                 *

*                                                                  *

*                                                                  *

********************************************************************

 

type-pools: kkblo.

tables: opsystem,     path, dd03l.

tables:     /pbs/max_size_z3.                               "PBSW060406

tables:     /pbs/cfi_custom.                                "PBSW261011

tables:     /pbs/cfi_txw_cvt.                               "PBSW070716

tables:     adr6.                                           "PBSC231018

 

*  DATA: O_LEN TYPE I.                           "PBSW041102 "PBSW020606

*  DATA: TOTAL_LEN TYPE I.                       "PBSW041102 "PBSW020606

data: o_len(10) type p.                                     "PBSW020606

* DATA: TOTAL_LEN(10) TYPE P.                    "PBSW020606 "PBSW260606

data: total_len(16) type p.                                 "PBSW260606

data: vol_count(4) type p.                                  "PBSW041102

 

* Maximale Dateigröße                                        "PBSW041102

 

* PBS Standardeinstellung sind 600 MB (CD-Größe).            "PBSW041102

*DATA: MAX_LEN TYPE I VALUE '0629145600' .                   "PBSW060406

*DATA: MAX_LEN TYPE I.                                       "PBSW080506

* data: MAX_LEN(10) TYPE p.                       "PBSW080506 "PBSW290419

data: max_len(12) type p.                                   "PBSW290419

 

* Bytes per MB (1024 * 1024)                                 "PBSW060406

data: bytes_val type i value '0001048576'.                  "PBSW060406

 

* zum Testen kann der Schalter verkleinert werden.           "PBSW041102

* DATA: MAX_LEN TYPE I VALUE '1048576'.                     "PBSW041102

*  DATA: MAX_LEN TYPE I VALUE '0000004096'.

data: begin of volume,                                      "PBSW041102

        x1(1) type c value 'V',                             "PBSW041102

        x2(4) type c value '0000',                          "PBSW041102

      end of volume.                                        "PBSW041102

data: sav_outfile type char255.                             "PBSW041102

data: outfile type char255.

 

data: outfile_xml type char255.                             "PBSW160316

data: dirname_xml type char128.                             "PBSW160316

data: exist_xml type c.                                     "PBSW160316

data: sepsign_xml type c value '/'.                         "PBSW160316

 

data: outfile_bset type char255.                            "PBSC030810

data: outfile_bseg type char255.                            "PBSC030810

data: outfile_vbak type char255.

data: outfile_likp type char255.

data: outfile_vbrk type char255.

data: outfile_vbpa type char255.

data: outfile_konv type char255.

data: outfile_afru type char255.                            "PBSW180803

data: outfile_afvc type char255.                            "PBSW180803

data: exist type c.

data: reply type c.

data: fieldlist type standard table of kkblo_fieldcat.

data: fieldlist_wa type kkblo_fieldcat.                     "PBSW30408

data: fieldlist_vbrk type standard table of kkblo_fieldcat.

data: fieldlist_vbak type standard table of kkblo_fieldcat.

data: fieldlist_likp type standard table of kkblo_fieldcat.

data: fieldlist_vbpa type standard table of kkblo_fieldcat.

data: fieldlist_konv type standard table of kkblo_fieldcat.

data: fieldlist_afru type standard table of kkblo_fieldcat. "PBSW180803

data: fieldlist_afvc type standard table of kkblo_fieldcat. "PBSW180803

 

data: generatedprog(8) type c.

data: generatedprog_konv(8) type c.

data: generatedprog_vbpa(8) type c.

data: generatedprog_afvc(8) type c.                         "PBSW180803

data: generatedprog_bset(8) type c.                         "PBSC030810

data: st_report like trdir-name .                           "PBSC030810

data: incl_name(72) type c.                                 "PBSW231003

data: ex_tabname  type kkblo_tabname.

data: numextractedpositions type i.

data: dataset_check_once(1) type c.

data:  reftab like dd02l-tabname.                           "PBSW100602

types: begin of headerstruct, "PBSY

         fieldname(64) type c,

         datatype(4)   type c,

         intlength     like dd03l-intlen,

       end of headerstruct.

data: headertable type standard table of headerstruct.

*  DATA: OUTLINE(2048) TYPE C. "PBSY                        "PBSW140307

* DATA: OUTLINE(5120) TYPE C. "PBSY              "PBSW140307"PBSW290309

* DATA: OUTLINE(6500) TYPE C. "PBSY              "PBSW290309"PBSC160316

data: outline(10000) type c.                                "PBSC160316

 

data: success type c. "PBSY

* Exportstatistik

types: begin of statisticsstruct, "PBSY

         bukrs      like bkpf-bukrs,

         currency   like bkpf-waers,

*Anfang                                                     "PBSW141021

*        SOLLSUMME  TYPE P DECIMALS 2,

*        HABENSUMME TYPE P DECIMALS 2,

         sollsumme  like faglflexa-hsl,

         habensumme like faglflexa-hsl,

         rfbusu00_S like faglflexa-hsl,                     "PBSW151221

         rfbusu00_h like faglflexa-hsl,                     "PBSW151221

 

 

*Ende                                                       "PBSW141021

       end of statisticsstruct.

data: statstruct type statisticsstruct.

data: statisticstable type standard table of statisticsstruct

          with header line.

 

* Feldverwaltung Extrakt

types: tlinetype(72) type c.

data: listing type standard table of tlinetype.

data: currentline type tlinetype.

data: line type kkblo_fieldcat.

data: errorline type i.

data: errormessage type char255.

data: tmpstring(255) type c.

* DATA: COUNTER TYPE I.                               "PBSW071104

data: counter_x type i.                                     "PBSW071104

data: numentries type i.

data: numentriesdate type i.

data: numentriestime type i.

data: intval(7) type c.

data: datetab type standard table of kkblo_fieldcat.

data: timetab type standard table of kkblo_fieldcat.

data: outlength type i.

data: numdec type decimals.

data: suffixpos type i.

* DATA: LEN TYPE I.                                   "PBSW071104

data: len_x type i.                                         "PBSW071104

data: tmpfieldname like dd03l-fieldname.

data: y_auto(1) type c.

* Anfang                                              "PBSC090605

data: y_adm(1)  type c.

data: y_INFO(60) type c.

data: y_conv(1) type c.

tables: tbtcp , tsp01,

        sscrfields.

tables: /pbs/die_dir2,

        /pbs/util_xadm .

tables: t000, toaar.

*

data : begin of dummy_dir2  occurs 0.

         include structure /pbs/die_dir2.

data : end of dummy_dir2 .

 

data: p_xtrct_uuid like /pbs/die_dir2-xtrct_uuid.

* Anfang                                               "PBSC110107

data: one_job(1) type c.

* Ende                                                 "PBSC110107

data: jobcount  like tbtcp-jobcount,

      jobname   like tbtcp-jobname,

      stepcount like tbtcp-stepcount.

data: pri_parameter      like pri_params.

data: arc_parameter      like arc_params.

*

data: begin of x_jobhead.

        include structure tbtcjob.

data: end of x_jobhead.

 

data: begin of x_steplist occurs 10.

        include structure tbtcstep.

data: end of x_steplist.

*

data begin of protocol_tbl occurs 50.

include structure tbtc5.

data end of protocol_tbl.

data: spool_tbl like rspo_ds2  occurs 1000.                 "PBSC300508

 

* DATA: BEGIN OF SPOOL_TBL OCCURS 1000,

*        ZEILE(4096) TYPE C.

* DATA: END OF SPOOL_TBL.

*

data : extr_len(8) type p.

data : x_message(3) type c.

* Ende                                                      "PBSC090605

field-symbols: <typefieldsymbol> type any.

* Anfang                                                    "PBSW071104

*  FIELD-SYMBOLS: <DATA1> TYPE C.                              "PBSWUNI

*  FIELD-SYMBOLS: <DATA2> TYPE C.                              "PBSWUNI

field-symbols: <data1_x> type c.                              "PBSWUNI

field-symbols: <data2_x> type c.                              "PBSWUNI

* Ende                                                      "PBSW071104

* Anfang                                                    "PBSW240403

data: begin of x_eol,

        cr(1) type x,

        lf(1) type x,

      end   of x_eol.

* Ende                                                       "PBSW240403

 

* Anfang                                                     "PBSW181104

data: begin of x_eol_u,

        cr(2) type x,

        lf(2) type x,

      end   of x_eol_u.

* Ende                                                       "PBSW181104

 

*Anfang                                                      "PBSW100220

*DATA: BEGIN OF X_EOL_text,

*        CR(1) TYPE c,

*        LF(1) TYPE c,

*      END   OF X_EOL_text.

*Ende                                                        "PBSW100220

 

 

 

 

 

data: x_bw(1) type c.                                       "PBSW121104

data: nai_check(1) type c.                                  "PBSC180112

parameters: h_prefix type  /PBS/txw_prefix no-display.      "PBSC220218

parameters: h_at type c no-display.                         "PBSW070721

 

*Anfang                                                      "PBSW250719

parameters: h_anonym  type /pbs/txw_anonym no-display.

parameters: h_textmd  type char1 no-display.                "PBSW011121

data: anonymous type char1.

data: begin of anonym_BUF,

        bukrs like bkpf-bukrs,

        belnr like bkpf-belnr,

        gjahr like bkpf-gjahr,

      end   of anonym_BUF.

 

*Ende                                                        "PBSW250719

 

 

parameters h_exlang like t002-spras no-display.             "PBSW210819

 

 

 

********************************************************************

*                                                                  *

*                                                                  *

*                  Ma k r o                                        *

*                                                                  *

*                                                                  *

********************************************************************

define cmove.

* Anfang                                                "PBSW071104

*  ASSIGN &1 TO <DATA1> CASTING.

*  ASSIGN &2 TO <DATA2> CASTING.

*  MOVE <DATA1> TO <DATA2>.

  assign &1 to <data1_x> casting.

  assign &2 to <data2_x> casting.

  move <data1_x> to <data2_x>.

* Ende                                                  "PBSW071104

end-of-definition.

 

 

 

********************************************************************

*                                                                  *

*                                                                  *

*                  P f a d  u n d  D a t e i p r ü f u n g         *

*                                                                  *

*                                                                  *

********************************************************************

 

 

 

********************************************************************

*  FORM: buildFileName

********************************************************************

*  PARAMETERS:

*    DirName        [in]: Verzeichnisname

*    FileName       [in]: Dateiname

*    BuiltFileName [out]: zusammengebauter Name

********************************************************************

*  baut einen Verzeichnis- und Dateinamen zusammen

********************************************************************

form buildfilename using dirname filename builtfilename.

* data: h_prefix type  /PBS/txw_prefix.         "PBSW120118"PBSC220218

  data:

    strlength type i,

    dummyname type char10,

    sepsign   type c value '/'.

 

  if sy-opsys = 'Windows NT'.

    sepsign = '\'.

  else.

    sepsign = '/'.

  endif.

 

  strlength = strlen( dirname ).

  if strlength > 0.

    strlength = strlength - 1.

    if dirname+strlength <> '/' and dirname+strlength <> '\'.

      concatenate dirname sepsign into dirname.

    endif.

  endif.

 

*Anfang                                                        "PBSW120118

*  import h_prefix from database indx(YP) id '%PBS_DTNAMEPREFIX%'.

*if sy-calld <> space.

* Anfang PBSC220218

*select single * from /PBS/CFI_CUSTOM where repid eq '/PBS/CFI_LIS_TXW_MONITOR'

*                                      and   reportparameter eq 'P_PREFIX'.

* h_prefix = /PBS/CFI_CUSTOM-WERT.

* Ende PBSC220218

  if not h_prefix is initial and sy-calld <> space.

    concatenate dirname h_prefix filename into builtfilename.

  else.

    concatenate dirname filename into builtfilename.

  endif.

*endif.

*Ende                                                       "PBSW120118

 

*  CONCATENATE DIRNAME  FILENAME INTO BUILTFILENAME.        "PBSW120118

endform.

 

********************************************************************

*  FORM: doesDirectoryExist

********************************************************************

*  PARAMETERS:

*    DirName     [in]: Verzeichnisname

*    Exist      [out]: 'X', wenn das Verzeichnis existiert

********************************************************************

*  prüft, ob ein Verzeichnis existiert

********************************************************************

form doesdirectoryexist using dirname exist.

  data:

    strlength     type i,

    builtfilename type char255,

    dummyname     type char10.

* Anfang PBSC040316

  data i_generic_name(75) type c value '*'.

  call 'C_DIR_READ_FINISH' ." just to be sure              "PBSC260716

  call 'C_DIR_READ_START'

           id 'DIR'    field dirname

           id 'FILE'   field i_generic_name.

  if sy-subrc <> 0.

    exist = ' '.

  else.

    exist = 'X'.

  endif.

  call 'C_DIR_READ_NEXT'   .        "Must be called after C_DIR_READ_START

  call 'C_DIR_READ_FINISH'    .

  if exist = ' '.

    exit.

  endif.

* Ende  PBSC040316

  perform buildfilename using dirname 'ZZDummyFile' builtfilename.

 

* Anfang  PBSW251021

  data l_auth_check_filename like authb-filename.

  l_auth_check_filename =  builtfilename.

* PBSM310323 Anfang

  if l_auth_check_filename ne builtfilename.

* Schreiben in Pfad DSN

* könnte über Tabelle SPTH ausdrücklich erlaubt sein "PBSL011122

    call function 'SYSTEM_HOOK_OPEN_DATASET'

      exporting

        dataset       = builtfilename

        openmode      = 'W'

      exceptions

        no_permission = 1.

    if sy-subrc is not initial.

      message e604(/pbs/cfi)

        with builtfilename(50) builtfilename+50(50)

             builtfilename+100(50) builtfilename+150(50).

    endif.

  else.

* PBSM310323 Ende

    call function 'AUTHORITY_CHECK_DATASET'

      exporting

        activity         = 'WRITE'

        filename         = l_auth_check_filename

      exceptions

        no_authority     = 1

        activity_unknown = 2

        others           = 3.

*

    if sy-subrc is not initial.

*     MESSAGE E812(FR) WITH TEXT-FLE L_AUTH_CHECK_FILENAME."PBSM310323

      message e604(/pbs/cfi)

        with builtfilename(50) builtfilename+50(50)

             builtfilename+100(50) builtfilename+150(50).

                                                            "PBSM310323

    endif.

*Ende     PBSW251021

  endif.                                                    "PBSM310323

 

  open dataset builtfilename for output in text mode encoding default.

  if sy-subrc <> 0.

*Anfang                                                     "PBSW211216

    wait up to 3 seconds.

    open dataset builtfilename for output in text mode encoding default.

    if sy-subrc <> 0.

      exist = ' '.

    else.

      exist = 'X'.

      delete dataset builtfilename.

    endif.

*Ende                                                       "PBSW212116

*   EXIST = ' '.                                            "PBSW211216

  else.

    exist = 'X'.

    delete dataset builtfilename.

  endif.

endform.

 

********************************************************************

*  FORM: doesFileExist

********************************************************************

*  PARAMETERS:

*    FileName    [in]: Dateiname (vollständiger Pfad)

*    Exist      [out]: 'X', wenn die Datei existiert

********************************************************************

*  prüft, ob eine Datei existiert

********************************************************************

form doesfileexist using filename exist.

* Anfang  PBSW251021

  data l_auth_check_filename like authb-filename.

  l_auth_check_filename =  filename.

* PBSM310323 Anfang

  if l_auth_check_filename ne filename.

* Schreiben in Pfad DSN

* könnte über Tabelle SPTH ausdrücklich erlaubt sein "PBSL011122

    call function 'SYSTEM_HOOK_OPEN_DATASET'

      exporting

        dataset       = filename

        openmode      = 'R'

      exceptions

        no_permission = 1.

    if sy-subrc is not initial.

      message e604(/pbs/cfi)

        with filename(50) filename+50(50)

             filename+100(50) filename+150(50).

    endif.

  else.

* PBSM310323 Ende

    call function 'AUTHORITY_CHECK_DATASET'

      exporting

        activity         = 'READ'

        filename         = l_auth_check_filename

      exceptions

        no_authority     = 1

        activity_unknown = 2

        others           = 3.

*

    if sy-subrc is not initial.

*   MESSAGE E812(FR) WITH TEXT-FLE L_AUTH_CHECK_FILENAME."PBSM310323

      message e604(/pbs/cfi)

        with filename(50) filename+50(50)

             filename+100(50) filename+150(50).

                                                            "PBSM310323

    endif.

*Ende     PBSW251021

  endif.                                                    "PBSM310323

 

  open dataset filename for input in text mode encoding default.

  if sy-subrc = 0.

    exist = 'X'.

    close dataset filename.

  else.

    exist = ' '.

  endif.

endform.

 

********************************************************************

*  FORM: createOutputFile

********************************************************************

*  PARAMETERS:

*    FileName    [in]: Dateiname (vollständiger Pfad)

*    Success    [out]: 'X', wenn die Datei geöffnet werden konnte

********************************************************************

*  erzeugt eine Datei zum Schreiben. Ist die Datei bereits vorhanden,

*  wird ihr alter Inhalt gelöscht!

********************************************************************

form createoutputfile using filename success.

  success = ' '.

* Anfang  PBSW251021

  data l_auth_check_filename like authb-filename.

  l_auth_check_filename =  filename.

* PBSM310323 Anfang

  if l_auth_check_filename ne filename.

* Schreiben in Pfad DSN

* könnte über Tabelle SPTH ausdrücklich erlaubt sein "PBSL011122

    call function 'SYSTEM_HOOK_OPEN_DATASET'

      exporting

        dataset       = filename

        openmode      = 'W'

      exceptions

        no_permission = 1.

    if sy-subrc is not initial.

      message e604(/pbs/cfi)

        with filename(50) filename+50(50)

             filename+100(50) filename+150(50).

    endif.

  else.

* PBSM310323 Ende

    call function 'AUTHORITY_CHECK_DATASET'

      exporting

        activity         = 'WRITE'

        filename         = l_auth_check_filename

      exceptions

        no_authority     = 1

        activity_unknown = 2

        others           = 3.

*

    if sy-subrc is not initial.

*   MESSAGE E812(FR) WITH TEXT-FLE L_AUTH_CHECK_FILENAME."PBSM310323

      message e604(/pbs/cfi)

        with filename(50) filename+50(50)

             filename+100(50) filename+150(50).

                                                            "PBSM310323

    endif.

*Ende     PBSW251021

  endif.                                                    "PBSM310323

 

 

* Datei erzeugen (und falls sie existiert, Inhalt löschen)

  open dataset filename for output in text mode encoding default.

  if sy-subrc = 0.

    close dataset filename.

* Datei zum Anhängen öffnen

 

*wasi

 

*    OPEN DATASET FILENAME FOR OUTPUT IN TEXT MODE ENCODING DEFAULT.      "PBSW240403

* if 1 = 2.

    if h_textmd eq space.                                   "PBSW011121

      open dataset filename for appending in

                                legacy                      "PBSW090804

                                binary mode                 "PBSW240403

                                ignoring conversion errors. "PBSW090804

*Anfang                                                     "PBSW011121

    else.

 

      open dataset filename for appending in

                                                            "PBSW090804

                                text mode                   "PBSW240403

                                ignoring conversion errors

                                encoding utf-8.             "PBSW090804

    endif.

*Ende                                                      "PBSW011121

 

 

 

    if sy-subrc = 0.

      if y_adm eq'X'.                                       "PBSC090605

        perform verwaltung using outfile dirname.           "PBSC090605

      endif.                                                "PBSC090605

      success = 'X'.

    endif.

  endif.

endform.

 

 

********************************************************************

*                                                                  *

*                                                                  *

* Feldleisten nachlesen und ausgeben                               *

*                                                                  *

*                                                                  *

********************************************************************

 

 

********************************************************************

*  FORM: getVariantFields

********************************************************************

*  PARAMETERS:

*    FileName    [in]: Dateiname (vollständiger Pfad)

*    Exist      [out]: 'X', wenn die Datei existiert

********************************************************************

*  prüft, ob eine Datei existiert

********************************************************************

form getvariantfields using fieldlist type standard table.

  data: s_layout type kkblo_layout.

  data: s_fieldcat type kkblo_t_fieldcat.

  data: field type kkblo_fieldcat.

  data: fields type standard table of kkblo_fieldcat.

  data: x_width like syst-linsz.

  data: x_table(20) type c.                                   "PBSW

 

  data: i_tabname_item(30) type c.                          "PBSC180112

  if  variant-handle eq 'BKPF'                              "PBSC180112

  and variant-report eq '/PBS/CFI_LIS_ITEM'                 "PBSC180112

  and nai_check      eq 'X'.                                "PBSC180112

    i_tabname_item  = 'XBSEG'.                              "PBSC180112

  endif.                                                    "PBSC180112

  clear fieldlist[].

 

  call function 'REUSE_ALV_TRANSFER_DATA'

    exporting

      it_fieldcat = fieldcat

      is_layout   = layout

    importing

      et_fieldcat = s_fieldcat

      es_layout   = s_layout.

 

  call function 'LT_VARIANT_LOAD'

    exporting

      i_tabname           = ex_tabname

      i_tabname_slave     = i_tabname_item        "PBSC180112

      i_dialog            = 'N'

      i_user_specific     = 'X'

    importing

      et_fieldcat         = s_fieldcat[]

    changing

      cs_layout           = s_layout

      ct_default_fieldcat = s_fieldcat

      cs_variant          = variant

    exceptions

      wrong_input         = 1

      fc_not_complete     = 2

      not_found           = 3

      others              = 4.

 

* Ende                                                      "PBSW241002

  if sy-subrc = 3.

*   Anfang                                            PBSW070602

    perform set_fieldcat tables s_fieldcat.

*   Ende                                              PBSW070602

* Variante wurde nicht gefunden

*    MESSAGE S600 WITH TEXT-018.                      PBSW070602

*    LEAVE.                                           PBSW070602

  endif.

 

* Anfang                                                    "PBSW060707

  if s_layout-s_variant-variant cs '/TXW'.

    x_table = s_layout-s_variant-variant.

    shift x_table by 1 places left in character mode.

    loop at s_fieldcat into field.

      field-ref_tabname = x_table.

      modify s_fieldcat from field.

    endloop.

  endif.

 

* Ende                                                      "PBSW060707

 

  loop at s_fieldcat into field.

 

 

    if ( ( field-no_out <> 'X' and field-tech is initial ) or

       ( field-key = 'X' and field-tech is initial ) ) and

       field-outputlen > 0.

      append field to fields.

    endif.

  endloop.

*  READ TABLE S_FIELDCAT WITH KEY FIELDNAME = 'MANDT' INTO FIELD.

  loop at s_fieldcat into field.

    if field-fieldname cs 'MANDT'

    or field-fieldname cs 'RCLNT'                           "PBSW020707

    or field-fieldname cs 'CLIENT'.                         "PBSW070716

*    move_corresponding s_fieldcat to field.

      exit.

    endif.

  endloop.

  sort fields by col_pos.

  fieldlist[] = fields[].

  if field-fieldname cs 'MANDT'                             "PBSW100602

    or field-fieldname cs 'RCLNT'                           "PBSW020707

    or field-fieldname cs 'CLIENT'.                         "PBSW070716

    insert field into fieldlist index 1.

  else.

 

  endif.                                                    "PBSW100602

endform.

 

********************************************************************

*  FORM: getFieldsInfo

********************************************************************

*  PARAMETERS:

*    FieldList   [in]: Feldbeschreibungen der Variante

*    FieldsInfo [out]: Informationen über die Felder

********************************************************************

*  ermittelt Feldinformationen

********************************************************************

form getfieldsinfo using fieldlist type standard table

                         fieldsinfo type standard table.

  data: line type kkblo_fieldcat.

  data: info type headerstruct.

 

*Anfang                                                         "PBSW060116

  data: v_len type i.

  if dfname cs 'TXW_'.

    loop at fieldlist into line.

      line-ref_tabname = dfname.

      v_len = strlen( line-fieldname ).

      v_len = v_len - 2.

      if dfname = 'TXW_BI_HD' and line-fieldname cs 'STCEG'. "PBSC101225

        continue.                                            "PBSC101225

      endif.                                                 "PBSC101225

      if line-fieldname+v_len(1) eq '_'.

        line-fieldname+v_len(2) = space.

      endif.

*Anfang                                                        "PBSW070716

*  if dfname cs 'TXW_BI' or

*     dfname cs 'TXW_MM_HD'.

*     case line-fieldname.

*     when 'X_BUKRS'.

*          line-fieldname = 'BUKRS'.

*     when 'X_BELNR'.

*          line-fieldname = 'BELNR'.

*     when 'X_GJAHR'.

*          line-fieldname = 'BELNR'.

*     endcase.

*   endif.

      select single * from /pbs/cfi_txw_cvt

              where tabname eq dfname

              and   fieldname eq line-fieldname.

      if syst-subrc eq 0.

        if not /pbs/cfi_txw_cvt-fieldname_new is initial.

          line-fieldname = /pbs/cfi_txw_cvt-fieldname_new.

        endif.

        if not /pbs/cfi_txw_cvt-inttype_new is initial.

          line-inttype = /pbs/cfi_txw_cvt-inttype_new.

        endif.

        if not /pbs/cfi_txw_cvt-decimals_new is initial.

          line-decimals = /pbs/cfi_txw_cvt-decimals_new.

        endif.

      endif.

 

 

*Ende                                                        "PBSW070716

      modify fieldlist from line.

    endloop.

  endif.

*Ende                                                        "PBSW060116

 

  clear fieldsinfo[].

 

  loop at fieldlist into line.

 

    if line-intlen > 0.

      clear info.

 

*Anfang                                                     "PBSW271120

      if dfname cs 'TXW_'.

        info-fieldname = line-fieldname.

      else.

*Ende

        concatenate line-ref_tabname '-' line-fieldname into

            info-fieldname.

      endif.                                                "PBSW271120

      info-datatype = line-inttype.

*     INFO-INTLENGTH = LINE-INTLEN.                        "PBSW200407

      info-intlength = line-outputlen.                      "PBSW200407

      append info to fieldsinfo.

    endif.

  endloop.

 

 

endform.

 

********************************************************************

*  FORM: writeOutputHeader

********************************************************************

*  PARAMETERS:

*    FieldList   [in]: Feldbeschreibungen der Variante

********************************************************************

*  schreibt den Header

********************************************************************

form writeoutputheader using fieldlist type standard table extension.

 

 

 

  class cl_abap_char_utilities definition load.

  data tab type standard table of headerstruct with header line.

  data line type string.

* DATA SEP TYPE X VALUE '09'.

  data sep type c.

  data fieldline type kkblo_fieldcat.

  data intval type char32.

  data headertable type standard table of string with header line.

  data numentries type i.

  data numdec type decimals.

  data len type i.

  data tmpfieldname like dd03l-fieldname.

  data cr_lf(2) type c.                                     "PBSW190107

  data cr_lfx(4) type x.                                    "PBSW190107

  data: comp_0a(1) type x value '0A'.                       "PBSW190107

  data: comp_hex1(1) type x.                                "PBSW190107

 

*Anfang                                                    "PBSW261011

  data: dart_field_text(1) type c.

  data: rollname_txw like dd04t-rollname.

  select single * from /pbs/cfi_custom

     client specified

     where mandt eq sy-mandt

     and   repid eq '/PBS/CFI_LIS_INC'

     and   reportparameter eq 'DART_FIELD_TEXT'.

  if sy-subrc eq 0.

    dart_field_text = /pbs/cfi_custom-wert.

  endif.

*Ende                                                      "PBSW261011

*Anfang                                                    "PBSW301015

*  SEP = CL_ABAP_CHAR_UTILITIES=>HORIZONTAL_TAB.

  select single wert from /pbs/cfi_custom into sep

    where repid eq '/PBS/CFI_LIS_INC'

    and reportparameter eq 'FIELD_DELIMITER'.

  if sep is initial.

    sep = cl_abap_char_utilities=>horizontal_tab.

  endif.

*Ende                                                      "PBSW301015

* Anfang                                                    "PBSW190107

  cr_lf = cl_abap_char_utilities=>cr_lf.

  cmove cr_lf cr_lfx.

  if cl_abap_char_utilities=>charsize ne 1.

    case cl_abap_char_utilities=>endian.

* Little endian

      when 'L'.

        comp_hex1 = cr_lfx+2(1).

      when others.

* Big endian

        comp_hex1 = cr_lfx+3(1).

    endcase.

    if comp_hex1 eq comp_0a.

      x_eol-cr  = '0D'.

      x_eol-lf  = '0A'.

    else.

      x_eol-cr  = '0D'.

      x_eol-lf  = '25'.

    endif.

  else.

    if cr_lfx+1(1) eq comp_0a.

      x_eol-cr  = '0D'.

      x_eol-lf  = '0A'.

    else.

      x_eol-cr  = '0D'.

      x_eol-lf  = '25'.

    endif.

  endif.

* Ende                                                       "PBSW190107

 

*Anfang                                                      "PBSW100220

*x_eol_text-cr = cl_abap_char_utilities=>cr_lf(1).

*x_eol_text-lf = cl_abap_char_utilities=>cr_lf+1(1).

*Ende                                                        "PBSW100220

 

 

  if outfile = ''.

* hier Fehlermeldung ausgeben

  endif.

 

* Anfang                                                 "PBSW060406

  if max_len < 1.

    select single * from /pbs/max_size_z3.

    if syst-subrc <> 0.

      /pbs/max_size_z3-max_size = 600.

    endif.

    max_len = /pbs/max_size_z3-max_size * bytes_val.

  endif.

* Ende                                                   "PBSW060406

 

 

* Anfang                                                    "PBSW190107

* Anfang                                               "PBSW240403

*  IF SY-DBSYS EQ 'DB400     '.

**    SEP       = '05'.

*     X_EOL-CR  = '0D'.

*     X_EOL-LF  = '25'.

*  ELSE.

**    SEP       = '09'.

*     X_EOL-CR  = '0D'.

*     X_EOL-LF  = '0A'.

*

*  ENDIF.

* Ende                                                 "PBSW240403

* Ende                                                      "PBSW190107

 

  perform getfieldsinfo using fieldlist[] tab[].

* Feldnamen

*Anfang                                                    "PBSW171115

  if syst-repid eq '/PBS/CFI_LIS_ITEM'.

    data: seltab like standard table of rsparams with header line.

    call function 'RS_REFRESH_FROM_SELECTOPTIONS'

      exporting

        curr_report     = sy-cprog

      tables

        selection_table = seltab

      exceptions

        not_found       = 1

        no_report       = 2.

    loop at seltab where selname eq 'VARI_LIS' and low eq '/PBS/HSSM_1'.

    endloop.

    if syst-subrc eq 0.

      loop at tab.

 

        replace '_K' in tab-fieldname with '  '.

        replace '-'  in tab-fieldname with '_'.

        if tab-fieldname eq '/PBS/CFI_Z3_Z_PROJK_EX'.

          tab-fieldname = 'BSEG_WBS_POSID'.

        endif.

        modify tab.

      endloop.

    endif.

  endif.

*Ende                                                      "PBSW171115

  describe table tab lines numentries.

 

 

 

  if h_at eq space.                                         "PBSW070721

    loop at tab.

 

*  Anfang                                                  "PBSW11103

      if tab-fieldname(1) cs '/'.

        shift tab-fieldname by 1 places left.

      endif.

*  Ende                                                    "PBSW111103

      condense tab-fieldname.

      concatenate line tab-fieldname into line.

      if sy-tabix < numentries.

        concatenate line sep into line.

      endif.

    endloop.

 

*Anfang                                                    "PBSW070721

  else.

    loop at fieldlist into fieldline.

      if fieldline-fieldname(1) cs '/'.

        shift fieldline-fieldname by 1 places left.

      endif.

      case fieldline-tabname.

        when 'XGLA'.

          replace '_A' with space into fieldline-fieldname.

          replace '_T' with space into fieldline-fieldname.

        when 'XKUN'.

          replace '_A' with space into fieldline-fieldname.

          replace '_B' with space into fieldline-fieldname.

        when 'XLIF'.

          replace '_A' with space into fieldline-fieldname.

          replace '_B' with space into fieldline-fieldname.

        when 'XANLA'.

          replace '_A' with space into fieldline-fieldname.

          replace '_B' with space into fieldline-fieldname.

      endcase.

      condense fieldline-fieldname.

      concatenate line fieldline-fieldname into line.

      if sy-tabix < numentries.

        concatenate line sep into line.

      endif.

    endloop.

 

 

  endif.

*Ende                                                      "PBSW070721

 

  append line to headertable.

* Beschreibung

 

*Anfang                                                    "PBSW070721

  if  h_at <> space.

 

    loop at headertable.

      o_len = strlen( headertable ).                        "PBSW240303

      transfer headertable to outfile length o_len.         "PBSW240303

*Anfang                                                     "PBSW100220

*Anfang                                                     "PBSW170522

      if    variant-variant(3) eq '/BE'.

        transfer '|' to outfile length 1.

      endif.

*Ende                                                       "PBSW170522

 

      transfer x_eol to outfile length 2.                   "PBSW240303

*   transfer x_eol_text to outfile length 2.

*Ende                                                       "PBSW100220

*   TRANSFER HEADERTABLE TO OUTFILE.                        "PBSW240303

*   O_LEN = STRLEN( HEADERTABLE ).               "PBSW041102"PBSW240303

      add o_len to total_len.                               "PBSW041102

      add 1 to total_len.                                   "PBSW041102

    endloop.

  else.

 

*Ende                                                                "PBSW070721

 

 

    clear line.

    loop at fieldlist into fieldline.

      condense fieldline-seltext.

      if not ( fieldline-seltext is initial ).              "PBSW100602

        concatenate line fieldline-seltext into line.

      else.                                                 "PBSW100602

        concatenate line fieldline-seltext_l into line.     "PBSW100602

      endif.                                                "PBSW100602

 

      if sy-tabix < numentries.

        concatenate line sep into line.

      endif.

    endloop.

    append line to headertable.

* Feldbezeichnung

    clear line.

    loop at fieldlist into fieldline.

      if dart_field_text eq space.                          "PBSW261011

        condense fieldline-reptext.

        if not ( fieldline-reptext is initial ).            "PBSW100602

          concatenate line fieldline-reptext into line.

        else.                                               "PBSW100602

          select reptext from dd04t into fieldline-reptext  "PBSW100602

                   where rollname                           "PBSW100602

                   eq  fieldline-fieldname                  "PBSW100602

                  and ddlanguage eq syst-langu.             "PBSW100602

 

          endselect.                                        "PBSW100602

          concatenate line fieldline-reptext into line.     "PBSW100602

        endif.                                              "PBSW100602

*Anfang                                                    "PBSW261011

      else.

        concatenate 'TXW_' fieldline-fieldname into rollname_txw.

        select ddtext from dd04t into fieldline-reptext

              where rollname

              eq  rollname_txw

 

                  and ddlanguage eq syst-langu.             "PBSW100602

 

        endselect.

        if syst-subrc <> 0.

 

          select ddtext from dd04t into fieldline-reptext

                    where rollname

                    eq  fieldline-fieldname

 

                  and ddlanguage eq syst-langu.             "PBSW100602

 

          endselect.

        endif.

        translate fieldline-reptext to upper case.

        concatenate line fieldline-reptext into line.

      endif.

*Ende                                                      "PBSW261011

      if sy-tabix < numentries.

        concatenate line sep into line.

      endif.

    endloop.

    append line to headertable.

* Datentyp

    clear line.

    loop at tab.

      condense tab-datatype.

      translate tab-datatype using 'FC'.                    "PBSW120606

      translate tab-datatype using 'sP'.                    "PBSW120606

      translate tab-datatype using 'IP'.                    "PBSW120606

      concatenate line tab-datatype into line.

      if sy-tabix < numentries.

        concatenate line sep into line.

      endif.

    endloop.

    append line to headertable.

* Datentyplänge

    clear line.

    loop at tab.

      intval = tab-intlength.

      condense intval.

      concatenate line intval into line.

      if sy-tabix < numentries.

        concatenate line sep into line.

      endif.

    endloop.

    append line to headertable.

* Anzahl Dezimalstellen

    clear line.

    loop at fieldlist into fieldline.

      condense fieldline-decimals.

      numdec = fieldline-decimals.

      if fieldline-inttype = 'P' and fieldline-decimals = 0.

        len = strlen( fieldline-ref_fieldname ).

        tmpfieldname = fieldline-ref_fieldname.

*     SEARCH TMPFIELDNAME FOR '_K'.

        search tmpfieldname for extension.

        if sy-subrc = 0.

          tmpfieldname+sy-fdpos(2) = ' '.

          condense tmpfieldname.

        endif.

        if tmpfieldname cs '_K' and                         "PBSW240403

           tmpfieldname cs 'KURSF'.                         "PBSW240403

          tmpfieldname = 'KURSF'.                           "PBSW240403

        endif.                                              "PBSW240403

 

* Anfang                                                 "PBSW010616

        case fieldline-ref_tabname.

          when 'TXW_KNC3'.

            select decimals from dd03l into numdec where

            tabname = 'KNC3' and fieldname = tmpfieldname.

 

            endselect.

          when 'TXW_LFC3'.

            select decimals from dd03l into numdec where

            tabname = 'LFC3' and fieldname = tmpfieldname.

            endselect.

*Anfang                                                     "PBSW070716

          when 'TXW_ANLC'.

            select decimals from dd03l into numdec where

            tabname = 'ANLC' and fieldname = tmpfieldname.

            endselect.

            if syst-subrc <> 0.

              select decimals from dd03l into numdec where

              tabname = 'ANLCV' and fieldname = tmpfieldname.

              endselect.

 

 

            endif.

 

*Ende                                                       "PBSW070716

 

          when others.

* Ende

 

            select decimals from dd03l into numdec where

                tabname = fieldline-ref_tabname and fieldname = tmpfieldname.

            endselect.

        endcase.                                            "PBSW010616

        if syst-subrc <> 0.                                 "PBSW120104

          select decimals from dd03l into numdec where      "PBSW120104

          tabname = fieldline-ref_tabname                   "PBSW120104

          and fieldname    = tmpfieldname(5).               "PBSW120104

          endselect.                                        "PBSW120104

        endif.                                              "PBSW120104

 

      endif.

 

      intval = numdec.

      concatenate line intval into line.

      if sy-tabix < numentries.

        concatenate line sep into line.

      endif.

    endloop.

    append line to headertable.

* Währungs-/Mengenkennzeichen (vorerst leer)

    clear line.

    loop at fieldlist into fieldline.

      if sy-tabix < numentries.

        concatenate line sep into line.

      endif.

    endloop.

    append line to headertable.

* spezielle Feldtypen (vorerst leer)

    clear line.

    loop at fieldlist into fieldline.

      if sy-tabix < numentries.

        concatenate line sep into line.

      endif.

    endloop.

    append line to headertable.

 

    loop at headertable.

      o_len = strlen( headertable ).                        "PBSW240303

      transfer headertable to outfile length o_len.         "PBSW240303

*Anfang                                                     "PBSW100220

 

      if h_textmd eq space.                                 "PBSW011121

        transfer x_eol to outfile length 2.                 "PBSW240303

      endif.                                                "PBSW011121

*   transfer x_eol_text to outfile length 2.

*Ende                                                       "PBSW100220

*   TRANSFER HEADERTABLE TO OUTFILE.                        "PBSW240303

*   O_LEN = STRLEN( HEADERTABLE ).               "PBSW041102"PBSW240303

      add o_len to total_len.                               "PBSW041102

      add 1 to total_len.                                   "PBSW041102

    endloop.

  endif.                                                    "PBSW070721

*Anfang                                                     "PBSW160316

  if exist_xml <> space.

    perform buildfilename using dirname_xml dfname outfile_xml.

 

* Anfang  PBSW251021

    data l_auth_check_filename like authb-filename.

    l_auth_check_filename =  outfile_xml.

* PBSM310323 Anfang

    if l_auth_check_filename ne outfile_xml.

* Schreiben in Pfad DSN

* könnte über Tabelle SPTH ausdrücklich erlaubt sein "PBSL011122

      call function 'SYSTEM_HOOK_OPEN_DATASET'

        exporting

          dataset       = outfile_xml

          openmode      = 'W'

        exceptions

          no_permission = 1.

      if sy-subrc is not initial.

        message e604(/pbs/cfi)

          with outfile_xml(50) outfile_xml+50(50)

               outfile_xml+100(50) outfile_xml+150(50).

      endif.

    else.

* PBSM310323 Ende

      call function 'AUTHORITY_CHECK_DATASET'

        exporting

          activity         = 'READ'

          filename         = l_auth_check_filename

        exceptions

          no_authority     = 1

          activity_unknown = 2

          others           = 3.

*

      if sy-subrc is not initial.

*   MESSAGE E812(FR) WITH TEXT-FLE L_AUTH_CHECK_FILENAME."PBSM310323

        message e604(/pbs/cfi)

          with outfile_xml(50) outfile_xml+50(50)

               outfile_xml+100(50) outfile_xml+150(50).

                                                            "PBSM310323

      endif.

*Ende     PBSW251021

    endif.                                                  "PBSM310323

 

    open dataset outfile_xml for appending in

                                  legacy

                                  binary mode

                                  ignoring conversion errors.

    loop at headertable.

      o_len = strlen( headertable ).

      transfer headertable to outfile_xml length o_len.

      transfer x_eol to outfile_xml length 2.

*   TRANSFER HEADERTABLE TO OUTFILE.

*   O_LEN = STRLEN( HEADERTABLE ).

      add o_len to total_len.

      add 1 to total_len.

    endloop.

    close dataset outfile_xml.

*   commit work.                                             "PBSW020616

  endif.

*Ende                                                        "PBSW160316

 

endform.

 

********************************************************************

*  FORM: appendExportFile

********************************************************************

*  PARAMETERS:

*    OutLine   [out]: zu schreibende Zeile

********************************************************************

*  schreibt eine Positionszeile ins Exportfile

********************************************************************

form appendexportfile using outline.

  if outfile = ''.

* hier Fehlermeldung ausgeben

  endif.

  include /pbs/cfi_lis_compress_transfer if found.          "PBSW040624

  o_len = strlen( outline ).                                "PBSW240403

* TRANSFER OUTLINE TO OUTFILE.                             "PBSW240403

  transfer outline to outfile length o_len.                 "PBSW240403

 

*Anfang                                                     "PBSW170522

  if    sy-slset(3) eq 'BE_' or

 

    variant-variant(3) eq '/BE'.

 

    transfer '|' to outfile length 1.

  endif.

*Ende                                                       "PBSW170522

*Anfang                                                     "PBSW100220

  if h_textmd eq space.                                     "PBSW011121

    transfer x_eol to outfile length 2.

  endif.                                                    "PWBS011121

*transfer x_eol_text to outfile length 2.

*Ende                                                       "PBSW100220

 

 

 

 

* O_LEN = STRLEN( OUTLINE ).                               "PBSW240403

  add o_len to total_len.                                   "PBSW041102

  add 1 to total_len.                                       "PBSW041102

 

  numextractedpositions = numextractedpositions + 1.

endform.

*   Anfang                                                 "PBSW041102

form verify_file_size.

  data:  save_dfname  type char64.                          "PBSW040820

  save_dfname = dfname.                                     "PBSW040820

  if total_len > max_len.

*Anfang                                                    "PBSW070721

    if h_at <> space.

      replace '.TXT' with space into outfile.

*  sy-cprog eq '/PBS/CFI_LIS_VENDOR'   or

*   sy-cprog eq '/PBS/CFI_LIS_CUSTOMER' or

*   sy-cprog eq '/PBS/CFI_LIS_ASSET'    or

*   sy-cprog eq '/PBS/CFI_LIS_CSKS'.

*    data: seltab like standard table of rsparams with header line.

*    call function 'RS_REFRESH_FROM_SELECTOPTIONS'

*      exporting

*        curr_report     = sy-cprog

*      tables

*        selection_table = seltab

*      exceptions

*        not_found       = 1

*        no_report       = 2.

*    loop at seltab where selname cs 'VAR'.

*     if seltab-selname eq 'VAR_AM' or

*        seltab-selname eq 'VAR_STAM' or

*        seltab-selname eq 'VARI_LIS' and

*        seltab-low cs '/AT_'.

*        replace '.TXT' with space into outfile.

*        exit.

*     endif.

*

*     endloop.

    endif.

*Ende                                                      "PBSW070721

    if sav_outfile is initial.

      sav_outfile = outfile.

    endif.

    close dataset outfile.

    perform verwaltung_size using outfile dirname.          "PBSC090605

    total_len = 0.

    o_len = 0.

    vol_count = volume-x2.

    add 1 to vol_count.

    unpack vol_count to volume-x2.

    volume-x1 = 'V'.

    clear outfile.

    concatenate sav_outfile volume into outfile.

 

*Anfang                                                    "PBSW070721

 

    if h_at <> space.

      replace '.TXT' with space into outfile.

      concatenate outfile '.TXT' into outfile. condense outfile.

    endif.

 

*if sy-cprog eq '/PBS/CFI_LIS_VENDOR'   or

*   sy-cprog eq '/PBS/CFI_LIS_CUSTOMER' or

*   sy-cprog eq '/PBS/CFI_LIS_ASSET'    or

*   sy-cprog eq '/PBS/CFI_LIS_CSKS'.

*    refresh seltab.

*    call function 'RS_REFRESH_FROM_SELECTOPTIONS'

*      exporting

*        curr_report     = sy-cprog

*      tables

*        selection_table = seltab

*      exceptions

*        not_found       = 1

*        no_report       = 2.

*    loop at seltab where selname cs 'VAR'.

*     if seltab-selname eq 'VAR_AM' or

*        seltab-selname eq 'VAR_STAM' or

*        seltab-selname eq 'VARI_LIS' and

*        seltab-low cs '/AT_'.

*        concatenate outfile '.TXT' into outfile. condense outfile.

*     exit.

*     endif.

*

*endloop.

*endif.

*Ende                                                      "PBSW070721

 

 

 

 

    perform createoutputfile using outfile success.

    if success = ' '.                                       "PBSC090605

*        Datei konnte nicht geöffnet werden              "PBSC090605

      message e600(fr) with text-016.                       "PBSC090605

      exit.                                                 "PBSC090605

    endif.                                                  "PBSC090605

    if exist_xml <> space.                                  "PBSW160316

      concatenate sav_outfile volume into outfile_xml.      "PBSW160316

      concatenate dfname volume into dfname.                "PBSW040820

    endif.                                                  "PBSW160316

 

    perform writeoutputheader using fieldlist[] '  '.

    perform set_correct_tab_value in program (generatedprog).

 

  endif.

  dfname = save_dfname.                                     "PBSW040820

 

endform.

*  Ende                                                   "PBSW041102

 

 

form pruefe_datei_pfad.

  data: ld_length type i,                                   "PBSW040820

        ld_offset type i.                                   "PBSW040820

 

  check sscrfields-ucomm ne 'KNOT'.                         "PBSC090605

* PBSY start

*IF EXP = 'X'.                                            "PBSC090605

  if exp = 'X' or y_conv = 'X'.                             "PBSC090605

    if dirname = '' or dfname = ''.

*   MESSAGE E600 WITH TEXT-020.                           "PBSW151104

      message e600(fr) with text-020.                       "PBSW151104

*   EXIT.

    endif.

* Prüfe ob Pfad vorhanden

    perform doesdirectoryexist using dirname exist.

* Anfang                                                  "PBSW160316

    if sy-opsys = 'Windows NT'.

      sepsign_xml = '\'.

    else.

      sepsign_xml = '/'.

    endif.

 

    ld_length = strlen( dirname ).                          "PBSW040820

    ld_offset = ld_length - 5.                              "PBSW040820

    if dirname+ld_offset <> '/XML/'.                        "PBSW040820

 

      concatenate dirname 'XML' sepsign_xml into dirname_xml. condense dirname_xml no-gaps.

      perform doesdirectoryexist using dirname_xml exist_xml.

      if exist_xml is initial. dirname_xml = dirname. endif.

    endif.                                                  "PBSW040820

* Ende                                                    "PBSW160316

    if exist = 'X'.

      if y_auto eq space.

*Anfang                                                                           "PBSW040820

        if sy-cprog eq '/PBS/CFI_LIS_GENERATE_XML' and exist_Xml is not initial.

          perform buildfilename using DIRNAME_xml dfname outfile.

        else.

*Ende                                                                             "PBSW040820

          perform buildfilename using dirname dfname outfile.

        endif.                                              "PBSW040820

* Prüfe ob Datei vorhanden

 

        perform doesfileexist using outfile exist.

      else.

        exist = space.

      endif.

      if syst-batch eq space.

        if exist = 'X'.

          if dataset_check_once eq space.

*            dataset_check_once = 'X'.

            call function 'POPUP_TO_CONFIRM_STEP'

              exporting

                defaultoption = 'N'

                textline1     = text-013

*               TEXTLINE2     = ''                     "PBSW150824

                textline2     = Outfile                "PBSW150824

                titel         = text-014

                start_column  = 25

                start_row     = 6

              importing

                answer        = reply.

          else.

            reply = 'J'.

          endif.

        endif.

      else.

*   Im Batch wird immer überschrieben.

        exist =  space.

      endif.

      if reply = 'J' or exist = ' '.

*       IF SY-UCOMM <> SPACE.

*          IF SY-UCOMM <> 'SPOS'.

*              PERFORM CREATEOUTPUTFILE USING OUTFILE SUCCESS.

*              IF SUCCESS = ' '.

*               Datei konnte nicht geöffnet werden

*                MESSAGE E600 WITH TEXT-016.

*                EXIT.

*             ENDIF.

*          ENDIF.

*      ENDIF.

      else.

        leave.

      endif.

    else.

*   MESSAGE E600 WITH TEXT-015.                            "PBSW151104

      message e600(fr) with text-015.                       "PBSW151104

      exit.

    endif.

  endif.

endform.

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Einzelposten                     *

*                                                                  *

*                                                                  *

********************************************************************

 

 

********************************************************************

*  FORM: generateExternals

********************************************************************

*  PARAMETERS:

*    FieldList   [in]: Feldbeschreibungen der Variante

********************************************************************

*  generiert ein externes Programm, in dem die gewünschte Struktur

*  und die erforderlichen FORMS erzeugt werden:

*    FORM genBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> YBSEG

*    FORM genXBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> XBSEG

*    FORM modifyTimeDate: konvertiert Datum und Zeit in das von AIS

*                         geforderte Format

********************************************************************

form generateexternals_item using fieldlist type standard table.

 

 

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  if st_report eq '/PBS/CFI_LIS_ITEM_NEU'.                  "PBSC030813

    append 'INCLUDE /PBS/CFI_LIS_STRU_XBSEG_BSET.' to listing. "30813

  else.                                                     "PBSC030813

    append 'INCLUDE /PBS/CFI_LIS_STRU_XBSEG.' to listing.

  endif.                                                    "PBSC030813

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (YBSEG)

  append 'FORM genBSEGLine USING BsegLine LIKE YBSEG OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YBSEG.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

  perform anonymous_externals_item using 'BSEGLine' 'YBSEG'. "PBSW250719

 

  append '  MOVE-CORRESPONDING BSegLine TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

 

* Form 2 Start: Erzeugung der gefüllten Zeile (XBSEG)

  append 'FORM genXBSEGLine USING BsegLine LIKE XBSEG OutLine.'

                                                    to listing.

  append '  DATA Cl LIKE XBSEG.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

  append '  MOVE-CORRESPONDING BSegLine TO TGeneratedHeaderType.'

                  to listing.

  perform  datum_uhrzeit_uebernehmen.

 

  perform  abschliessen_und_generieren.

endform.

 

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Anlageposten                     *

*                                                                  *

*                                                                  *

********************************************************************

 

 

********************************************************************

*  FORM: generateExternals

********************************************************************

*  PARAMETERS:

*    FieldList   [in]: Feldbeschreibungen der Variante

********************************************************************

*  generiert ein externes Programm, in dem die gewünschte Struktur

*  und die erforderlichen FORMS erzeugt werden:

*    FORM genBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> YBSEG

*    FORM genXBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> XBSEG

*    FORM modifyTimeDate: konvertiert Datum und Zeit in das von AIS

*                         geforderte Format

********************************************************************

form generateexternals_item_aa using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XANEP.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (YANEP)

  append 'FORM genANEPLine USING ANEPVLINE LIKE YANEPV OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YANEPV.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

  perform anonymous_externals_item using 'ANEPVLINE' 'YANEPV'. "PBSW250719

 

  append '  MOVE-CORRESPONDING ANEPVLine TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

 

* Form 2 Start: Erzeugung der gefüllten Zeile (XANEP)

*  APPEND 'FORM genXANEPLine USING ANEPVLine LIKE YANEPV OutLine.'

*                                                    TO LISTING.

*  APPEND '  DATA Cl LIKE XANEPV.' TO LISTING.

*  APPEND '  CLEAR Cl.' TO LISTING.

*  APPEND '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' TO LISTING.

*  APPEND '  MOVE-CORRESPONDING ANEPVLine TO TGeneratedHeaderType.'

*                  TO LISTING.

*  PERFORM  DATUM_UHRZEIT_UEBERNEHMEN.

 

  perform  abschliessen_und_generieren.

endform.

 

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Materialposten                   *

*                                                                  *

*                                                                  *

********************************************************************

 

 

********************************************************************

*  FORM: generateExternals

********************************************************************

*  PARAMETERS:

*    FieldList   [in]: Feldbeschreibungen der Variante

********************************************************************

*  generiert ein externes Programm, in dem die gewünschte Struktur

*  und die erforderlichen FORMS erzeugt werden:

*    FORM genBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> YBSEG

*    FORM genXBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> XBSEG

*    FORM modifyTimeDate: konvertiert Datum und Zeit in das von AIS

*                         geforderte Format

********************************************************************

form generateexternals_item_mseg using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XMSEG.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (YMSEG)

  append 'FORM genMSEGLine USING MSEGLINE LIKE YMSEG OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YMSEG.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

*

  perform anonymous_externals_item using 'MSEGLine' 'YMSEG'. "PBSW250719

 

 

 

  append '  MOVE-CORRESPONDING MSEGLine TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

 

 

 

  perform  abschliessen_und_generieren.

endform.

 

* Anfang                                                   "PBSW210802

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Bestellungen                     *

*                                                                  *

*                                                                  *

********************************************************************

 

 

********************************************************************

*  FORM: generateExternals

********************************************************************

*  PARAMETERS:

*    FieldList   [in]: Feldbeschreibungen der Variante

********************************************************************

*  generiert ein externes Programm, in dem die gewünschte Struktur

*  und die erforderlichen FORMS erzeugt werden:

*    FORM genBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> YBSEG

*    FORM genXBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> XBSEG

*    FORM modifyTimeDate: konvertiert Datum und Zeit in das von AIS

*                         geforderte Format

********************************************************************

form generateexternals_item_ekpo using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XEKPO.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (YEKPO)

  append 'FORM genEKPOLine USING EKPOLINE LIKE YEKPO OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YEKPO.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

 

  perform anonymous_externals_item using 'EKPOLINE' 'YEKPO'. "PBSW250719

 

 

 

  append '  MOVE-CORRESPONDING EKPOLine TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

 

 

 

  perform  abschliessen_und_generieren.

endform.

 

* Ende                                                     "PBSW210802

* Anfang                                                   "PBSW280802

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für CO-Einzelposten                  *

*                                                                  *

*                                                                  *

********************************************************************

 

 

********************************************************************

*  FORM: generateExternals

********************************************************************

*  PARAMETERS:

*    FieldList   [in]: Feldbeschreibungen der Variante

********************************************************************

*  generiert ein externes Programm, in dem die gewünschte Struktur

*  und die erforderlichen FORMS erzeugt werden:

*    FORM genBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> YBSEG

*    FORM genXBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> XBSEG

*    FORM modifyTimeDate: konvertiert Datum und Zeit in das von AIS

*                         geforderte Format

********************************************************************

form generateexternals_item_coep using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XCOEP.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (YEKPO)

  append 'FORM genCOEPLine USING COEPLINE LIKE YCOEP OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YCOEP.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

* Anfang                                                                 "PBSW250719

  if anonymous <> space.

    perform anonymous_externals_item using 'COEPLINE' 'YCOEP'.

  endif.

* Ende                                                                   "PBSW250719

 

  append '  MOVE-CORRESPONDING COEPLine TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

 

 

 

  perform  abschliessen_und_generieren.

endform.

 

* Ende                                                     "PBSW280802

 

* Anfang                                                   "PBSW161002

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für EIKP-Daten                       *

*                                                                  *

*                                                                  *

********************************************************************

 

 

********************************************************************

*  FORM: generateExternals

********************************************************************

*  PARAMETERS:

*    FieldList   [in]: Feldbeschreibungen der Variante

********************************************************************

*  generiert ein externes Programm, in dem die gewünschte Struktur

*  und die erforderlichen FORMS erzeugt werden:

*    FORM genBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> YBSEG

*    FORM genXBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> XBSEG

*    FORM modifyTimeDate: konvertiert Datum und Zeit in das von AIS

*                         geforderte Format

********************************************************************

form generateexternals_item_eipo using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XEIPO.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (YEIPO)

  append 'FORM genEIPOLine USING EIPOLINE LIKE YEIPO OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YEIPO.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

 

  perform anonymous_externals_item using 'EIPOLINE' 'YEIPO'. "PBSW250719

 

 

 

 

  append '  MOVE-CORRESPONDING EIPOLine TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

 

 

 

  perform  abschliessen_und_generieren.

endform.

 

* Ende                                                     "PBSW161002

 

 

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Sachkontenstammdaten             *

*                                                                  *

*                                                                  *

 

********************************************************************

 

form generateexternals_xgla using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XGLA.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (XGLA)

  append 'FORM genXGLALine USING XGLALine LIKE XGLA  OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE XGLA. ' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

*

  perform anonymous_externals_item using 'XGLALINE' 'XGLA'. "PBSW250719

 

 

  append '  MOVE-CORRESPONDING XGLALine TO TGeneratedHeaderType.'

                  to listing.

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

endform.

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Sachkonten Verkehrszahlen in HW  *

*                                                                  *

*                                                                  *

********************************************************************

 

form generateexternals_xvkz using fieldlist type standard table.

 

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XGLA_VKZ.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_1'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (XGLA)

  append 'FORM genXVKZLine USING XVKZLine LIKE XGLA_VKZ  OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE XGLA_VKZ. ' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

 

 

  perform anonymous_externals_item using 'XVKZLine' 'XGLA_VKZ'. "PBSW250719

 

 

 

  append '  MOVE-CORRESPONDING XVKZLine TO TGeneratedHeaderType.'

                  to listing.

 

 

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

 

 

endform.

* Forms Ende

 

 

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Sachkonten Verkehrszahlen in FW  *

*                                                                  *

********************************************************************

 

form generateexternals_xfca using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XGLA_FCA.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_3'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (XGLA)

  append 'FORM genXFCALine USING XFCALine LIKE XGLA_FCA  OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE XGLA_FCA. ' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

 

  perform anonymous_externals_item using 'XFCALine' 'XGLA_FCA'. "PBSW250719

 

 

 

  append '  MOVE-CORRESPONDING XFCALine TO TGeneratedHeaderType.'

                  to listing.

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

 

endform.

* Anfang                                                   "PBSW020707

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Kreditoren anfangs-/endsalden    *

*                                                                  *

********************************************************************

 

form generateexternals_xven using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XLIF_VEN.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using ' '.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (XLIF)

  append 'FORM genXVENLine USING XVENLine LIKE XLIF_VEN  OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE XLIF_VEN. ' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

 

  perform anonymous_externals_item using 'XVENLine' 'XLIF_VEN'. "PBSW250719

 

 

  append '  MOVE-CORRESPONDING XVENLine TO TGeneratedHeaderType.'

                  to listing.

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

 

endform.

 

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Sachkonten anfangs-/endsalden    *

*                                                                  *

********************************************************************

 

form generateexternals_xbac using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XGLA_BAC.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using ' '.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (XGLA)

  append 'FORM genXBACLine USING XBACLine LIKE XGLA_BAC  OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE XGLA_BAC. ' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

*

  perform anonymous_externals_item using 'XBACLine' 'XGLA_BAC'. "PBSW250719

 

 

  append '  MOVE-CORRESPONDING XBACLine TO TGeneratedHeaderType.'

                  to listing.

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

 

endform.

 

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Debitoren  anfangs-/endsalden    *

*                                                                  *

********************************************************************

 

form generateexternals_xcus using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XKUN_CUS.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using ' '.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (XKUN)

  append 'FORM genXCUSLine USING XCUSLine LIKE XKUN_CUS  OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE XKUN_CUS. ' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

  perform anonymous_externals_item using 'XCUSLine' 'XKUN_CUS'. "PBSW250719

 

 

  append '  MOVE-CORRESPONDING XCUSLine TO TGeneratedHeaderType.'

                  to listing.

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

 

endform.

 

 

* Ende                                                     "PBSW020707

 

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Kreditorentammdaten              *

*                                                                  *

*                                                                  *

 

********************************************************************

 

form generateexternals_xlif using fieldlist type standard table.

 

  perform get_anonymous_values.                             "PBSW250719

 

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XLIF.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_B'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (XLIF)

  append 'FORM genXLIFLine USING XLIFLine LIKE XLIF  OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE XLIF. ' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

 

  perform anonymous_externals_item using 'XLIFLine' 'XLIF'. "PBSW250719

 

 

  append '  MOVE-CORRESPONDING XLIFLine TO TGeneratedHeaderType.'

                  to listing.

 

 

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

 

endform.

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Kreditoren Verkehrszahlen in HW  *

*                                                                  *

*                                                                  *

********************************************************************

 

form generateexternals_xlif_vkz using fieldlist type standard table.

 

  perform get_anonymous_values.                             "PBSW250719

 

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XLIF_VKZ.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_1'.

 

 

 

* Form 1 Start: Erzeugung der gefüllten Zeile (XGLA)

  append

  'FORM genXLIF_VKZLine USING XLIF_VKZLine LIKE XLIF_VKZ  OutLine.'

                                                       to listing.

  append '  DATA Cl LIKE XLIF_VKZ. ' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

 

  perform anonymous_externals_item using 'XLIF_VKZLine' 'XLIF_VKZ'. "PBSW250719

 

 

 

  append '  MOVE-CORRESPONDING XLIF_VKZLine TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

 

 

endform.

* Forms Ende

 

 

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Kreditoren sHB-Vorgänge         *

*                                                                  *

*                                                                  *

********************************************************************

 

form generateexternals_xlif_shb using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XLIF_SHB.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_3'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (XGLA)

  append

  'FORM genXLIF_SHBLine USING XLIF_SHBLine LIKE XLIF_SHB OutLine.'

                                                      to listing.

  append '  DATA Cl LIKE XLIF_SHB. '                  to listing.

  append '  CLEAR Cl.'                                to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

 

 

  perform anonymous_externals_item using 'XLIF_SHBLine' 'XLIF_SHB'. "PBSW250719

 

 

  append '  MOVE-CORRESPONDING XLIF_SHBLine TO TGeneratedHeaderType.'

                  to listing.

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

 

 

endform.

 

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Debitorenstammdaten              *

*                                                                  *

*                                                                  *

 

********************************************************************

 

form generateexternals_xkun using fieldlist type standard table.

 

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XKUN.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_B'.

 

 

* Form 1 Start: Erzeugung der gefüllten Zeile (XKUN)

  append 'FORM genXKUNLine USING XKUNLine LIKE XKUN  OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE XKUN. ' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

  perform anonymous_externals_item using 'XKUNLine' 'XKUN'. "PBSW250719

 

 

  append '  MOVE-CORRESPONDING XKUNLine TO TGeneratedHeaderType.'

                  to listing.

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

 

endform.

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Debitoren  Verkehrszahlen in HW  *

*                                                                  *

*                                                                  *

********************************************************************

 

form generateexternals_xkun_vkz using fieldlist type standard table.

 

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XKUN_VKZ.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_1'.

 

 

* Form 1 Start: Erzeugung der gefüllten Zeile (XGLA)

  append

  'FORM genXKUN_VKZLine USING XKUN_VKZLine LIKE XKUN_VKZ  OutLine.'

                                                       to listing.

  append '  DATA Cl LIKE XKUN_VKZ. ' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

 

  perform anonymous_externals_item using 'XKUN_VKZLine' 'XKUN_VKZ'. "PBSW250719

 

 

  append '  MOVE-CORRESPONDING XKUN_VKZLine TO TGeneratedHeaderType.'

                  to listing.

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

 

 

endform.

* Forms Ende

 

 

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Debitoren SHB-Vorgänge           *

*                                                                  *

*                                                                  *

********************************************************************

 

form generateexternals_xkun_shb using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XKUN_SHB.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_3'.

 

 

 

* Form 1 Start: Erzeugung der gefüllten Zeile (XGLA)

  append

  'FORM genXKUN_SHBLine USING XKUN_SHBLine LIKE XKUN_SHB OutLine.'

                                                      to listing.

  append '  DATA Cl LIKE XKUN_SHB. '                  to listing.

  append '  CLEAR Cl.'                                to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

 

  perform anonymous_externals_item using 'XKUN_SHBLine' 'XKUN_SHB'. "PBSW250719

 

 

 

  append '  MOVE-CORRESPONDING XKUN_SHBLine TO TGeneratedHeaderType.'

                  to listing.

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

 

 

endform.

 

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Posten zum Debitor               *

*                                                                  *

*                                                                  *

********************************************************************

 

form generateexternals_xari using fieldlist type standard table.

 

  perform get_anonymous_values.                             "PBSW250719

 

 

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XARI.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '  '.

 

 

* Form 1 Start: Erzeugung der gefüllten Zeile (XKUN)

  append 'FORM genXARILine USING XARILine LIKE XARI  OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE XARI. ' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

  perform anonymous_externals_item using 'XARILine' 'XARI'. "PBSW250719

 

 

  append '  MOVE-CORRESPONDING XARILine TO TGeneratedHeaderType.'

                  to listing.

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

 

endform.

 

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Posten zum Kreditor              *

*                                                                  *

*                                                                  *

********************************************************************

 

form generateexternals_xapi using fieldlist type standard table.

 

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XAPI.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '  '.

 

 

* Form 1 Start: Erzeugung der gefüllten Zeile (XKUN)

  append 'FORM genXAPILine USING XAPILine LIKE XAPI  OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE XAPI. ' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

  perform anonymous_externals_item using 'XAPILine' 'XAPI'. "PBSW250719

 

 

  append '  MOVE-CORRESPONDING XAPILine TO TGeneratedHeaderType.'

                  to listing.

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

 

endform.

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Posten zum Sachkonto             *

*                                                                  *

*                                                                  *

********************************************************************

 

form generateexternals_xgli using fieldlist type standard table.

 

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XGLI.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '  '.

 

 

* Form 1 Start: Erzeugung der gefüllten Zeile (XKUN)

  append 'FORM genXGLILine USING XGLILine LIKE XGLI  OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE XGLI. ' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

  perform anonymous_externals_item using 'XGLILine' 'XGLI'. "PBSW250719

 

 

  append '  MOVE-CORRESPONDING XGLILine TO TGeneratedHeaderType.'

                  to listing.

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

 

endform.

 

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Posten zum Sachkonto             *

*                                                                  *

*                                                                  *

********************************************************************

 

 

form generateexternals_xtab using fieldlist type standard table.

 

 

 

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

* Anfang                                                  "PBSW231003

*  APPEND 'INCLUDE /PBS/CFI_LIS_REFERENCE_STRU.' TO LISTING.

  append incl_name to listing.

* Ende.                                                   "PBSW231003

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '  '.

 

 

* Form 1 Start: Erzeugung der gefüllten Zeile (XKUN)

  append 'FORM genXTABLine USING XTABLine LIKE XTAB  OutLine.'

                                                       to listing.

  append '  DATA Cl LIKE XTAB. ' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

  perform anonymous_externals_xtab.                         "PBSW250719

 

  append '  MOVE-CORRESPONDING XTABLine TO TGeneratedHeaderType.'

                  to listing.

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

 

endform.

 

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Anlagenstammdaten               *

*                                                                  *

*                                                                  *

 

********************************************************************

 

form generateexternals_xanla using fieldlist type standard table.

 

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XANLA.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_C'.

 

 

* Form 1 Start: Erzeugung der gefüllten Zeile (XKUN)

  append 'FORM genXANLALine USING XANLALine LIKE XANLA  OutLine.'

                                                     to listing.

 

  append '  DATA Cl LIKE XANLA. ' to listing.

  append '  CLEAR Cl.' to listing.

*  perform set_correct_tab_value.                            "PBSUNI

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

  perform anonymous_externals_item using 'XANLALine' 'XANLA'. "PBSW250719

 

  append '  MOVE-CORRESPONDING XANLALine TO TGeneratedHeaderType.'

                  to listing.

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

 

endform.

 

********************************************************************

*                                                                  *

*                                                                  *

*   Teilroutinen für Extraktausgabe                                *

*                                                                  *

*                                                                  *

********************************************************************

 

********************************************************************

*   FORM DATUM_UND_UHRZEIT                                         *

********************************************************************

 

form datum_und_uhrzeit_aufbereiten.

  refresh: datetab, timetab.                                "PBSW100210

* alle Datums- und Uhrzeitfelder ermitteln

  loop at fieldlist into line.

    if line-inttype = 'D'.

      append line to datetab.

    elseif line-inttype = 'T'.

      append line to timetab.

    endif.

  endloop.

* Datums- und Uhrzeitstrukturen IMMER erzeugen (ggf. nur mit

* DUMMY-Feld)

  describe table datetab lines numentriesdate.

  append 'DATA: ' to listing.

  append '  BEGIN OF TmpDateStruct,' to listing.

  append '    ___ZZHemDUMMY TYPE C,' to listing.

  loop at datetab into line.

    concatenate line-fieldname '(10) TYPE C,' into currentline.

    append currentline to listing.

  endloop.

  append '  END OF TmpDateStruct.' to listing.

 

  describe table timetab lines numentriestime.

  append 'DATA: ' to listing.

  append '  BEGIN OF TmpTimeStruct,' to listing.

  append '    ___ZZHemDUMMY TYPE C,' to listing.

  loop at timetab into line.

    concatenate line-fieldname '(8) TYPE C,' into currentline.

    append currentline to listing.

  endloop.

  append '  END OF TmpTimeStruct.' to listing.

endform.

 

********************************************************************

*   FORM HEADER_UND_AUSGABELAENGE                                  *

********************************************************************

form  header_und_ausgabelaenge using indicator.

  append 'DATA:' to listing.

  append '    BEGIN OF TGeneratedHeaderType,' to listing.

* Header-Struktur mit korrekten Feldlängen

  loop at fieldlist into line.

    numdec = line-decimals.

    if line-intlen > 0.

      if line-inttype = 'P' and line-decimals = 0.

*        LEN = STRLEN( LINE-REF_FIELDNAME ).               "PBSW071104

        len_x = strlen( line-ref_fieldname ).               "PBSW071104

        tmpfieldname = line-ref_fieldname.

* Anfang PBSC131015

        case indicator .

          when 'DH'.         "/PBS/CFI_LIS_STRU_XVBAP

            search tmpfieldname for '_D'.

            if sy-subrc ne 0.

              search tmpfieldname for '_H'.

            endif.

          when others.

* Ende PBSC131015

            search tmpfieldname for indicator.

        endcase.                                            "PBSC131015

        if sy-subrc = 0.

          tmpfieldname+sy-fdpos(2) = ' '.

          condense tmpfieldname.

        endif.

 

        select decimals from dd03l into numdec where

            tabname = line-ref_tabname and fieldname = tmpfieldname.

        endselect.

        if syst-subrc <> 0.                                 "PBSW120104

          select decimals from dd03l into numdec where      "PBSW120104

          tabname = line-ref_tabname                        "PBSW120104

          and fieldname    = tmpfieldname(5).               "PBSW120104

          endselect.                                        "PBSW120104

        endif.                                              "PBSW120104

      endif.

      if line-inttype = 'P' and numdec > 0.

        if line-intlen > 16. line-intlen = 16. endif.        "PBSWUNI

        concatenate line-fieldname '(' line-intlen ') TYPE '

                      into currentline.

*        CONCATENATE CURRENTLINE LINE-INTTYPE 'DECIMALS' LINE-DECIMALS

* Anfang                                                                            "PBSW220116

* if syst-repid eq '/PBS/CFI_LIS_ITEM'.

*    data: seltab like standard table of rsparams with header line.

*    data: l_count type i.

*    call function 'RS_REFRESH_FROM_SELECTOPTIONS'

*      exporting

*        curr_report     = sy-cprog

*      tables

*        selection_table = seltab

*      exceptions

*        not_found       = 1

*        no_report       = 2.

*        l_count = 0.

*        loop at seltab where selname eq 'BR_BUKRS'.

*          l_count = l_count + 1.

*          if seltab-sign <> 'I'.

*             add 1 to l_count.

*          endif.

*          if seltab-option <> 'EQ'.

*             add 1 to l_count.

*          endif.

*

*        endloop.

*        if l_count = 1.

        perform set_decimals(/pbs/cfi_lis_inc_ext) using syst-cprog

                                                         line-ref_tabname

                                                         line-ref_fieldname

                                                         line-datatype

                                                         numdec

                                                         if found.

*        endif.

* endif.

*Ende                                                                               "PBSW220116

        concatenate currentline line-inttype 'DECIMALS' numdec

                ',' into currentline separated by ' '.

      else.

        if line-inttype ca'eE'. line-inttype = 'N'. endif.  "PBSW061217

        if line-inttype ca'bB'. line-inttype = 'N'. endif.  "PBSW250902

        if line-inttype ca'sS'. line-inttype = 'N'. endif.  "PBSW100602

        if line-inttype ca'fF'. line-inttype = 'N'. endif.   "PBSWUNI

        if line-inttype ca'tT'. line-inttype = 'C'. endif.  "PBSW100408

 

        if line-inttype eq 'D'                              "PBSW200407

        or line-inttype eq 'P'                              "PBSV300810

        or line-inttype eq 'T'.                             "PBSV301110

*or line-inttype eq 'N'.                                 "PBSC180609"PBSC250112

          concatenate line-fieldname '(' line-intlen ') TYPE '

          into currentline.

        else.                                               "PBSW200407

          concatenate line-fieldname '(' line-outputlen ') TYPE ' "PBSW200407

          into currentline.                                 "PBSW200407

 

        endif.                                              "PBSW200407

* Anfang PBSC250112

        if line-inttype eq 'N'.

          if line-intlen lt line-outputlen.

            concatenate line-fieldname '(' line-intlen ') TYPE '

                                                         into currentline.

          else.

            concatenate line-fieldname '(' line-outputlen ') TYPE '

                                                         into currentline.

          endif.

        endif.

* Ende   PBSC250112

        concatenate currentline line-inttype ',' into currentline

                        separated by ' '.

      endif.

      append currentline to listing.

    endif.

  endloop.

  append '    END OF TGeneratedHeaderType.' to listing.

 

* Struktur mit korrekten Ausgabelängen

  append 'DATA:' to listing.

  append 'BEGIN OF TGeneratedOutputType,' to listing.

*  COUNTER = 1.                                            "PBSW071104

  counter_x = 1.                                            "PBSW071104

  describe table fieldlist lines numentries.

  loop at fieldlist into line.

    line-outputlen = line-ddic_outputlen.                   "PBSW220605

    outlength = line-outputlen.

    if line-outputlen > 0.

      if line-inttype = 'D'.

        outlength = 10.

      elseif line-inttype = 'T'.

        outlength = 8.

      else.

        outlength = line-outputlen.

      endif.

      intval = outlength.

      condense intval.

*      CONCATENATE LINE-FIELDNAME '(' LINE-OUTPUTLEN ') TYPE C,'

      concatenate line-fieldname '(' intval ') TYPE C,'

                      into currentline.

      append currentline to listing.

*      IF COUNTER < NUMENTRIES.                            "PBSW071104

      if counter_x < numentries.                            "PBSW071104

* Tab-Zeichen nach jedem Feld einfügen (außer beim letzten Feld,

* sonst ungültiges AIS-File!)

*       INTVAL = COUNTER.                                  "PBSW071104

        intval = counter_x.                                 "PBSW071104

        condense intval.

        concatenate '___DUMMYVAR_HEM' intval into tmpstring.

*UNI     CONCATENATE TMPSTRING ' TYPE X VALUE ''09'',' INTO TMPSTRING.

        concatenate tmpstring ' TYPE C VALUE '';'',' into tmpstring.

*        CONCATENATE TMPSTRING ' TYPE C'

*                                     VALUE ''09'

 

*                                     ',' INTO TMPSTRING.

        append tmpstring to listing.

*       COUNTER = COUNTER + 1.                              "PBSW071104

        counter_x = counter_x + 1.                          "PBSW071104

      endif.

    endif.

  endloop.

  append '    END OF TGeneratedOutputType.' to listing.

endform.

********************************************************************

*   Datum_Uhrzeit_uebernehmen                                      *

********************************************************************

 

form datum_uhrzeit_uebernehmen.

* entsprechende Felder nach Datums-/Zeitstruktur schieben und ändern

  append '  MOVE-CORRESPONDING TGeneratedHeaderType TO TmpDateStruct.'

                                       to listing.

  append '  MOVE-CORRESPONDING TGeneratedHeaderType TO TmpTimeStruct.'

                                       to listing.

  append '  PERFORM modifyTimeDate USING TmpDateStruct TmpTimeStruct.'

                                       to listing.

 

  append '  MOVE-CORRESPONDING TGeneratedHeaderType TO ' to listing.

  append '       TGeneratedOutputType.'  to listing.

* geänderte Datums- und Zeitwerte zurückschreiben

  append '  MOVE-CORRESPONDING TmpDateStruct TO TGeneratedOutputType.'

                        to listing.

  append '  MOVE-CORRESPONDING TmpTimeStruct TO TGeneratedOutputType.'

 

                        to listing.

  append '  MOVE TGeneratedOutputType TO OutLine.' to listing.

  append 'ENDFORM.' to listing.

endform.

 

********************************************************************

*   Abschliessen_und_generieren.                                   *

********************************************************************

 

form abschliessen_und_generieren.

  perform append_listing.

  BREAK-POINT.

  generate subroutine pool listing name generatedprog line errorline

                                                   message errormessage.

  if sy-subrc <> 0.

* Programm konnte nicht generiert werden

*   MESSAGE E600 WITH TEXT-017.                            "PBSW151104

 

** Anfang                                                   "PBSW100408

    message i600(fr) with errormessage+000(50)

                          errormessage+050(50)

                          errormessage+100(50)

                          errormessage+150(50).

* Ende                                                     "PBSW100408                                                    "PBSW100408

    message e600(fr) with text-017.                         "PBSW151104

  endif.

endform.

 

********************************************************************

*   Abschliessen_und_generieren VBPA                               *

********************************************************************

 

form abschl_und_gen_vbpa.

  perform append_listing.

  generate subroutine pool listing name generatedprog_vbpa

  line errorline message errormessage.

  if sy-subrc <> 0.

* Programm konnte nicht generiert werden

*   MESSAGE E600 WITH TEXT-017.                           "PBSW151104

* Anfang                                                   "PBSW100408

    message i600(fr) with errormessage+000(50)

                          errormessage+050(50)

                          errormessage+100(50)

                          errormessage+150(50).

* Ende                                                     "PBSW100408

 

    message e600(fr) with text-017.                         "PBSW151104

  endif.

endform.

 

********************************************************************

*   Abschliessen_und_generieren KONV                               *

********************************************************************

 

form abschl_und_gen_konv.

  perform append_listing.

  generate subroutine pool listing name generatedprog_konv

  line errorline message errormessage.

  if sy-subrc <> 0.

* Programm konnte nicht generiert werden

*   MESSAGE E600 WITH TEXT-017.                           "PBSW151104

* Anfang                                                  "PBSW100408

    message i600(fr) with errormessage+000(50)

                          errormessage+050(50)

                          errormessage+100(50)

                          errormessage+150(50).

* Ende                                                    "PBSW100408

    message e600(fr) with text-017.                         "PBSW151104

  endif.

endform.

 

 

form append_listing.

* Form 3 Start: Zeit- und Datumswerte anpassen

  append 'FORM modifyTimeDate USING DateStruct LIKE TmpDateStruct' to

                    listing.

  append 'TimeStruct LIKE TmpTimeStruct.' to listing.

  append 'FIELD-SYMBOLS: <fs1> TYPE ANY.' to listing.

  append 'FIELD-SYMBOLS: <fs2> TYPE ANY.' to listing.

  append 'DATA: Date TYPE D.' to listing.

  append 'DATA: Time TYPE T.' to listing.

  append 'DATA: Counter TYPE I.' to listing.

* Datum

  append 'Counter = 2.' to listing.

  intval = numentriesdate.

  concatenate 'DO' intval 'TIMES.' into tmpstring separated by ' '.

  append tmpstring to listing.

* erstes Feld ist immer Dummy

  append 'ASSIGN COMPONENT Counter OF STRUCTURE DateStruct TO <fs1>.'

            to listing.

  append 'Date = <fs1>.' to listing.

  if x_bw is initial.                                       "PBSW121104

* Anfang                                               "PBSW160108

* APPEND 'WRITE Date TO <fs1> DD/MM/YYYY.' TO LISTING.

    append '<fs1>+0(2) = date+6(2).'         to listing.

    append '<fs1>+2(1) =  ''.''.'            to listing.

    append '<fs1>+3(2) = date+4(2).'         to listing.

    append '<fs1>+5(1) = ''.''.'             to listing.

    append '<fs1>+6(4) = date+0(4).'         to listing.

 

* Ende                                                 "PBSW160108

  endif.                                                    "PBSW121104

  append 'Counter = Counter + 1.' to listing.

  append 'ENDDO.' to listing.

* Uhrzeit

  append 'Counter = 2.' to listing.

  intval = numentriestime.

  concatenate 'DO' intval 'TIMES.' into tmpstring separated by ' '.

  append tmpstring to listing.

* erstes Feld ist immer Dummy

  append 'ASSIGN COMPONENT Counter OF STRUCTURE TimeStruct TO <fs2>.'

            to listing.

  append 'Time = <fs2>.' to listing.

  append 'WRITE Time TO <fs2>.' to listing.

  append 'Counter = Counter + 1.' to listing.

  append 'ENDDO.' to listing.

 

  append 'ENDFORM.' to listing.

* Forms Ende

* Anfang                                                     "PBSUNI

* Setzen des korrekten TAB-Wertes zwischen den Feldern

  append ' Form set_correct_tab_value.'                  to listing.

  append 'CLASS CL_ABAP_CHAR_UTILITIES DEFINITION LOAD.' to listing.

  append 'data sep(1) type c.'                           to listing.

*Anfang                                                       "PBSW3011015

  append 'select single wert from /pbs/cfi_custom into sep' to listing.

  append 'where repid eq ''/PBS/CFI_LIS_INC'' and'          to listing.

  append 'REPORTPARAMETER eq ''FIELD_DELIMITER''.'          to listing.

  append 'if sep is initial.'                               to listing.

  append 'sep = cl_abap_char_utilities=>horizontal_tab.'    to listing.

  append 'endif.'                                           to listing.

*APPEND 'sep = CL_ABAP_CHAR_UTILITIES=>horizontal_tab.' TO LISTING.

*Ende                                                         "PBSW301015

  append 'FIELD-SYMBOLS <FS> TYPE ANY.'                  to listing.

  append 'DO.'                                           to listing.

  append 'ASSIGN COMPONENT SY-INDEX OF'                  to listing.

  append 'STRUCTURE TGeneratedOutputType TO <FS>.'       to listing.

  append 'IF SY-SUBRC <> 0. EXIT. ENDIF.'                to listing.

  append 'IF <FS> cs '';''.'                             to listing.

  append '<FS> = sep.'                                   to listing.

  append 'endif.'                                        to listing.

  append 'ENDDO.'                                        to listing.

  append 'endform.'                                      to listing.

* Ende                                                       "PBSUNI

endform.

 

 

 

 

 

* Anfang                                                   "PBSW070602

form set_fieldcat

tables x_fieldcat.

*DATA: S_LAYOUT TYPE KKBLO_LAYOUT.

*DATA: S_FIELDCAT TYPE KKBLO_T_FIELDCAT.

*data: y_variant like DISVARIANT.

  data: begin of x_dd03l.

          include structure dd03l.

  data: end of x_dd03l.

*data: begin of x_dd04t.

*       include structure dd04t.

*data: end of x_dd04t.

  data: z_fieldcat type kkblo_fieldcat.

*data: x_col_pos type i.

 

*y_variant = x_variant.

* Setzen Variante

*clear y_variant.

*y_variant-report   = syst-cprog.

*y_variant-username = syst-uname.

*y_variant-variant  = '/PBS/XTAB'.

*x_variant = y_variant.

* Setzen layout

*s_layout = x_layout.

*clear s_layout.

*s_layout-zebra             = 'X'.

*s_layout-f2code            = 'DETA'.

*s_layout-new_fcodes        = 'X'.

*s_layout-MIN_LINESIZE      = '100'.

*s_layout-Max_LINESIZE      = '0'.

*s_layout-key_hotspot       = 'X'.

*s_layout-INFO_FIELDNAME    = 'COLOR'.

*s_layout-COLTAB_FIELDNAME  = 'COLFW'.

*s_layout-NO_SELINFOS       = 'X'.

*s_layout-ROWNO_CHANGE      = 'X'.

*s_layout-NO_NUMC_SUM       = 'X'.

 

* Füllen der Feldliste

*refresh s_fieldcat.

*x_col_pos = 0.

  loop at x_fieldcat into z_fieldcat.

    select * from  dd03l into corresponding fields of x_dd03l

             where tabname eq reftab

             and   fieldname eq z_fieldcat-fieldname.

      z_fieldcat-outputlen = x_dd03l-leng.

      z_fieldcat-decimals  = x_dd03l-decimals.              "PBSW160603

      case x_dd03l-inttype.

        when 'D'.

          z_fieldcat-intlen    = x_dd03l-leng.

        when 'T'.

          z_fieldcat-intlen    = x_dd03l-leng.

        when others.

          z_fieldcat-intlen    = x_dd03l-intlen.            "PBSW250902

      endcase.

      z_fieldcat-no_out = space.                            "PBSW250902

      exit.

    endselect.

*         SELECT * FROM DD04T INTO CORRESPONDING FIELDS OF x_dd04T

*            WHERE ROLLNAME   EQ  x_dd03l-rollname

*            AND   DDLANGUAGE EQ  SYST-LANGU.

*            EXIT.

*         ENDSELECT.

*         clear z_fieldcat.

*         add 1 to x_col_pos.

*         z_fieldcat-col_pos    = x_col_pos.

*         z_fieldcat-fieldname  = x_dd03l-fieldname.

*         z_fieldcat-tabname    = 'XTAB'.

*         if x_dd03l-KEYFLAG EQ 'X'.

*            z_fieldcat-key   = 'X'.

*         endif.

*         if z_fieldcat-fieldname = 'MANDT'.

*            z_fieldcat-tech      = 'X'.

*         endif.

*         z_fieldcat-datatype = x_dd03l-datatype.

*         z_fieldcat-inttype  = x_dd03l-inttype.

*         z_fieldcat-intlen   = x_dd03l-intlen.

*         z_fieldcat-seltext_l = x_dd04t-SCRTEXT_l.

*         z_fieldcat-seltext_m = x_dd04t-SCRTEXT_m.

*         z_fieldcat-seltext_s = x_dd04t-SCRTEXT_s.

    modify x_fieldcat from z_fieldcat.

  endloop.

 

 

*x_layout     = s_layout.

*x_fieldcat[] = s_fieldcat[].

endform.

* Ende                                                     "PBSW070602

* Anfang                                                   "PBSW130802

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Stammdatenänderungen             *

*                                                                  *

*                                                                  *

********************************************************************

 

 

********************************************************************

*  FORM: generateExternals

********************************************************************

*  PARAMETERS:

*    FieldList   [in]: Feldbeschreibungen der Variante

********************************************************************

*  generiert ein externes Programm, in dem die gewünschte Struktur

*  und die erforderlichen FORMS erzeugt werden:

*    FORM genBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> YBSEG

*    FORM genXBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> XBSEG

*    FORM modifyTimeDate: konvertiert Datum und Zeit in das von AIS

*                         geforderte Format

********************************************************************

form generateexternals_changes using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  if syst-cprog eq '/PBS/CFI_LIS_CHANGES_ITEMS'.

    append 'INCLUDE /PBS/CFI_LIS_STRU_XCDOC_FI.' to listing.

  else.

    append 'INCLUDE /PBS/CFI_LIS_STRU_XCDOC.' to listing.

  endif.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (YBSEG)

  append 'FORM genCDPOSLine USING CDPOSLine LIKE YCDPOS OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YCDPOS.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

  perform anonymous_externals_item using 'CDPOSLine' 'YCDPOS'. "PBSW250719

 

 

  append '  MOVE-CORRESPONDING CDPOSLine TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

endform.

 

* Ende                                                     "PBSW130802

* Anfang                                                   "PBSW040902

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Istposten Abstimmledger COFIS    *

*                                                                  *

*                                                                  *

********************************************************************

 

form generateexternals_xcofis using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XCOFIS.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '  '.

 

 

* Form 1 Start: Erzeugung der gefüllten Zeile (XKUN)

  append 'FORM genCOFISLine USING XCOFISLine LIKE YCOFIS  OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YCOFIS. ' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

  perform anonymous_externals_item using 'XCOFISLine' 'YCOFIS'. "PBSW250719

 

 

  append '  MOVE-CORRESPONDING XCOFISLine TO TGeneratedHeaderType.'

                  to listing.

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

 

endform.

 

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Zahlungsträgerdatei     PAYR     *

*                                                                  *

*                                                                  *

********************************************************************

 

form generateexternals_xpayr using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XPAYR.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '  '.

 

 

* Form 1 Start: Erzeugung der gefüllten Zeile (XKUN)

  append 'FORM genPAYRLine USING XPAYRLine LIKE YPAYR  OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YPAYR. ' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

  perform anonymous_externals_item using 'XPAYRLine' 'YPAYR'. "PBSW250719

 

  append '  MOVE-CORRESPONDING XPAYRLine TO TGeneratedHeaderType.'

                  to listing.

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

 

endform.

 

* Ende                                                     "PBSW040902

 

* Anfang                                                   "PBSW170902

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Fakturen VBRK                    *

*                                                                  *

*                                                                  *

********************************************************************

 

 

********************************************************************

*  FORM: generateExternals

********************************************************************

*  PARAMETERS:

*    FieldList   [in]: Feldbeschreibungen der Variante

********************************************************************

*  generiert ein externes Programm, in dem die gewünschte Struktur

*  und die erforderlichen FORMS erzeugt werden:

*    FORM genBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> YBSEG

*    FORM genXBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> XBSEG

*    FORM modifyTimeDate: konvertiert Datum und Zeit in das von AIS

*                         geforderte Format

********************************************************************

form generateexternals_item_vbrp using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XVBRP.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (YVBRP)

  append 'FORM genVBRPLine USING VBRPLINE LIKE YVBRP OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YVBRP.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

  perform anonymous_externals_item using 'VBRPLINE' 'YVBRP'. "PBSW250719

 

 

 

  append '  MOVE-CORRESPONDING VBRPLine TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

 

 

 

  perform  abschliessen_und_generieren.

endform.

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Fakturen VBAP                    *

*                                                                  *

*                                                                  *

********************************************************************

 

 

********************************************************************

*  FORM: generateExternals

********************************************************************

*  PARAMETERS:

*    FieldList   [in]: Feldbeschreibungen der Variante

********************************************************************

*  generiert ein externes Programm, in dem die gewünschte Struktur

*  und die erforderlichen FORMS erzeugt werden:

*    FORM genBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> YBSEG

*    FORM genXBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> XBSEG

*    FORM modifyTimeDate: konvertiert Datum und Zeit in das von AIS

*                         geforderte Format

********************************************************************

form generateexternals_item_vbap using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XVBAP.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

* PERFORM  HEADER_UND_AUSGABELAENGE USING '_K'.        "PBSC131015

  perform  header_und_ausgabelaenge using 'DH'.             "PBSC131015

 

* Form 1 Start: Erzeugung der gefüllten Zeile (YVBRP)

  append 'FORM genVBAPLine USING VBAPLINE LIKE YVBAP OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YVBAP.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

  perform anonymous_externals_item using 'VBAPLINE' 'YVBAP'. "PBSW250719

 

 

  append '  MOVE-CORRESPONDING VBAPLine TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

 

 

 

  perform  abschliessen_und_generieren.

endform.

 

 

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für SD Aufträge VBAK                 *

*                                                                  *

*                                                                  *

********************************************************************

 

 

 

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Lieferscheine LIKP               *

*                                                                  *

*                                                                  *

********************************************************************

 

 

********************************************************************

*  FORM: generateExternals

********************************************************************

*  PARAMETERS:

*    FieldList   [in]: Feldbeschreibungen der Variante

********************************************************************

*  generiert ein externes Programm, in dem die gewünschte Struktur

*  und die erforderlichen FORMS erzeugt werden:

*    FORM genBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> YBSEG

*    FORM genXBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> XBSEG

*    FORM modifyTimeDate: konvertiert Datum und Zeit in das von AIS

*                         geforderte Format

********************************************************************

form generateexternals_item_lips using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XLIPS.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (Ylips)

  append 'FORM genlipsLine USING lipsLINE LIKE Ylips OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE Ylips.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

  perform anonymous_externals_item using 'LIPSLine' 'YLIPS'. "PBSW250719

 

  append '  MOVE-CORRESPONDING lipsLine TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

 

 

 

  perform  abschliessen_und_generieren.

endform.

 

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Partnerdaten / Addressen         *

*                                                                  *

*                                                                  *

********************************************************************

 

 

********************************************************************

*  FORM: generateExternals

********************************************************************

*  PARAMETERS:

*    FieldList   [in]: Feldbeschreibungen der Variante

********************************************************************

*  generiert ein externes Programm, in dem die gewünschte Struktur

*  und die erforderlichen FORMS erzeugt werden:

*    FORM genBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> YBSEG

*    FORM genXBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> XBSEG

*    FORM modifyTimeDate: konvertiert Datum und Zeit in das von AIS

*                         geforderte Format

********************************************************************

form generateexternals_item_vbpa using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XVBPA.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (YVBPA]

  append 'FORM genVBPALine USING VBPALINE LIKE YVBPA OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YVBPA.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

  perform anonymous_externals_item using 'VBPALINE' 'YVBPA'. "PBSW250719

 

 

  append '  MOVE-CORRESPONDING VBPALine TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

  perform  abschl_und_gen_vbpa.

endform.

 

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Konditionen KONV                 *

*                                                                  *

*                                                                  *

********************************************************************

 

 

********************************************************************

*  FORM: generateExternals

********************************************************************

*  PARAMETERS:

*    FieldList   [in]: Feldbeschreibungen der Variante

********************************************************************

*  generiert ein externes Programm, in dem die gewünschte Struktur

*  und die erforderlichen FORMS erzeugt werden:

*    FORM genBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> YBSEG

*    FORM genXBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> XBSEG

*    FORM modifyTimeDate: konvertiert Datum und Zeit in das von AIS

*                         geforderte Format

********************************************************************

form generateexternals_item_konv using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_Xkonv.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (Ykonv)

  append 'FORM genkonvLine USING konvLINE LIKE Ykonv OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE Ykonv.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

  perform anonymous_externals_item using 'konvline' 'Ykonv'. "PBSW250719

 

 

  append '  MOVE-CORRESPONDING konvLine TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

 

 

 

  perform  abschl_und_gen_konv.

endform.

 

 

* Ende                                                     "PBSW170902

 

* Anfang                                                   "PBSW211002

********************************************************************

*  FORM: generateExternals

********************************************************************

*  PARAMETERS:

*    FieldList   [in]: Feldbeschreibungen der Variante

********************************************************************

*  generiert ein externes Programm, in dem die gewünschte Struktur

*  und die erforderlichen FORMS erzeugt werden:

*    FORM genBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> YBSEG

*    FORM genXBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> XBSEG

*    FORM modifyTimeDate: konvertiert Datum und Zeit in das von AIS

*                         geforderte Format

********************************************************************

form generateexternals_item_csla using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XCSLA.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (Ylips)

  append 'FORM genXCSLALine USING CSLALINE LIKE YCSLA OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YCSLA.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

*

  perform anonymous_externals_item using 'CSLALINE' 'YCSLA'. "PBSW250719

 

 

  append '  MOVE-CORRESPONDING cslaLine TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

 

 

 

  perform  abschliessen_und_generieren.

endform.

 

********************************************************************

*  FORM: generateExternals

********************************************************************

*  PARAMETERS:

*    FieldList   [in]: Feldbeschreibungen der Variante

********************************************************************

*  generiert ein externes Programm, in dem die gewünschte Struktur

*  und die erforderlichen FORMS erzeugt werden:

*    FORM genBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> YBSEG

*    FORM genXBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> XBSEG

*    FORM modifyTimeDate: konvertiert Datum und Zeit in das von AIS

*                         geforderte Format

********************************************************************

form generateexternals_item_cepc using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XCEPC.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (Ylips)

  append 'FORM genXCEPCLine USING CEPCLINE LIKE YCEPC OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YCEPC.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

  perform anonymous_externals_item using 'CEPCLine' 'YCEPC'. "PBSW250719

 

 

  append '  MOVE-CORRESPONDING CEPCLine TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

 

 

 

  perform  abschliessen_und_generieren.

endform.

 

********************************************************************

*  FORM: generateExternals

********************************************************************

*  PARAMETERS:

*    FieldList   [in]: Feldbeschreibungen der Variante

********************************************************************

*  generiert ein externes Programm, in dem die gewünschte Struktur

*  und die erforderlichen FORMS erzeugt werden:

*    FORM genBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> YBSEG

*    FORM genXBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> XBSEG

*    FORM modifyTimeDate: konvertiert Datum und Zeit in das von AIS

*                         geforderte Format

********************************************************************

form generateexternals_item_csks using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XCSKS.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (Ylips)

  append 'FORM genXCSKSLine USING CSKSLINE LIKE YCSKS OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YCSKS.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

  perform anonymous_externals_item using 'CSKSLINE' 'YCSKS'. "PBSW250719

 

  append '  MOVE-CORRESPONDING CSKSLine TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

 

 

 

  perform  abschliessen_und_generieren.

endform.

 

********************************************************************

*  FORM: generateExternals

********************************************************************

*  PARAMETERS:

*    FieldList   [in]: Feldbeschreibungen der Variante

********************************************************************

*  generiert ein externes Programm, in dem die gewünschte Struktur

*  und die erforderlichen FORMS erzeugt werden:

*    FORM genBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> YBSEG

*    FORM genXBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> XBSEG

*    FORM modifyTimeDate: konvertiert Datum und Zeit in das von AIS

*                         geforderte Format

********************************************************************

form generateexternals_item_cska using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XCSKA.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (Ylips)

  append 'FORM genXCSKALine USING CSKALINE LIKE YCSKA OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YCSKA.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

 

  perform anonymous_externals_item using 'CSKALINE' 'YCSKA'. "PBSW250719

 

 

 

  append '  MOVE-CORRESPONDING CSKALine TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

 

 

 

  perform  abschliessen_und_generieren.

endform.

 

********************************************************************

*  FORM: generateExternals

********************************************************************

*  PARAMETERS:

*    FieldList   [in]: Feldbeschreibungen der Variante

********************************************************************

*  generiert ein externes Programm, in dem die gewünschte Struktur

*  und die erforderlichen FORMS erzeugt werden:

*    FORM genBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> YBSEG

*    FORM genXBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> XBSEG

*    FORM modifyTimeDate: konvertiert Datum und Zeit in das von AIS

*                         geforderte Format

********************************************************************

form generateexternals_xmat using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XMAT.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (Ylips)

  append 'FORM genXMATLine USING XMATLINE LIKE XMAT OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE XMAT.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

  perform anonymous_externals_item using 'XMATLINE' 'XMAT'. "PBSW250719

 

 

  append '  MOVE-CORRESPONDING XMATLINE TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

 

 

 

  perform  abschliessen_und_generieren.

endform.

 

 

 

* Ende                                                     "PBSW211002

* Anfang                                                   "PBSW231002

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Istposten Abstimmledger COFIS    *

*                                                                  *

*                                                                  *

********************************************************************

 

form generateexternals_xttxy using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

 

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XTTXY.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '  '.

 

 

* Form 1 Start: Erzeugung der gefüllten Zeile (XKUN)

  append 'FORM genTTXYLine USING XTTXYLine LIKE YTTXY  OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YTTXY. ' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

  perform anonymous_externals_item using 'XTTXALINE' 'YTTXY'. "PBSW250719

 

 

  append '  MOVE-CORRESPONDING XTTXYline TO TGeneratedHeaderType.'

                  to listing.

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

 

endform.

* Ende                                                     "PBSW231002

* Anfang                                                   "PBSW180803

********************************************************************

*   Abschliessen_und_generieren AFVC                               *

********************************************************************

 

form abschl_und_gen_afvc.

  perform append_listing.

  generate subroutine pool listing name generatedprog_afvc

  line errorline message errormessage.

  if sy-subrc <> 0.

* Programm konnte nicht generiert werden

    message e600(fr) with text-017.

  endif.

endform.

 

********************************************************************

*  FORM: generateExternals AFRU

********************************************************************

*  PARAMETERS:

*    FieldList   [in]: Feldbeschreibungen der Variante

********************************************************************

*  generiert ein externes Programm, in dem die gewünschte Struktur

*  und die erforderlichen FORMS erzeugt werden:

*    FORM genBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> YBSEG

*    FORM genXBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> XBSEG

*    FORM modifyTimeDate: konvertiert Datum und Zeit in das von AIS

*                         geforderte Format

********************************************************************

form generateexternals_item_afru using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XAFRU.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (YAFRU]

  append 'FORM genAFRULine USING AFRULINE LIKE YAFRU OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YAFRU.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

 

  perform anonymous_externals_item using 'AFRULine' 'YAFRU'. "PBSW250719

 

  append '  MOVE-CORRESPONDING AFRULine TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

endform.

form generateexternals_item_afvc using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XAFVC.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (YAFVC]

  append 'FORM genAFVCLine USING AFVCLINE LIKE YAFVC OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YAFVC.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

  perform anonymous_externals_item using 'AFVCLINE' 'YAFVC'. "PBSW250719

 

 

  append '  MOVE-CORRESPONDING AFVCLine TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

  perform  abschl_und_gen_afvc.

endform.

 

* Ende                                                     "PBSW180803

* Anfang                                                   "PBSW040304

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Änderung Customizingdaten        *

*                                                                  *

*                                                                  *

********************************************************************

 

form generateexternals_xcust using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_TAPROT.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '  '.

 

 

* Form 1 Start: Erzeugung der gefüllten Zeile (XKUN)

  append 'FORM genXCUSTLine USING XCUSTLine LIKE YCUST OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YCUST. ' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

  perform anonymous_externals_item using 'XCUSTLine' 'YCUST'. "PBSW250719

 

 

  append '  MOVE-CORRESPONDING XCUSTLine TO TGeneratedHeaderType.'

                  to listing.

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

 

endform.

 

* Ende                                                     "PBSW040304

* Anfang                                                   "PBSW070404

********************************************************************

*  FORM: generateExternals

********************************************************************

*  PARAMETERS:

*    FieldList   [in]: Feldbeschreibungen der Variante

********************************************************************

*  generiert ein externes Programm, in dem die gewünschte Struktur

*  und die erforderlichen FORMS erzeugt werden:

*    FORM genBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> YBSEG

*    FORM genXBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> XBSEG

*    FORM modifyTimeDate: konvertiert Datum und Zeit in das von AIS

*                         geforderte Format

********************************************************************

form generateexternals_item_bila using fieldlist type standard table.

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XBILA.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (Ylips)

  append 'FORM genXBILALine USING BILALINE LIKE YBILA OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YBILA.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

  append '  MOVE-CORRESPONDING BILALine TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

 

 

 

  perform  abschliessen_und_generieren.

endform.

 

* Ende                                                     "PBSW070404

 

* Anfang                                                   "PBSW140404

********************************************************************

*  FORM: generateExternals

********************************************************************

*  PARAMETERS:

*    FieldList   [in]: Feldbeschreibungen der Variante

********************************************************************

*  generiert ein externes Programm, in dem die gewünschte Struktur

*  und die erforderlichen FORMS erzeugt werden:

*    FORM genBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> YBSEG

*    FORM genXBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> XBSEG

*    FORM modifyTimeDate: konvertiert Datum und Zeit in das von AIS

*                         geforderte Format

********************************************************************

form generateexternals_item_gitt using fieldlist type standard table.

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XGITT.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (Ylips)

  append 'FORM genXGITTLine USING GITTLINE LIKE YGITT OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YGITT.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

  append '  MOVE-CORRESPONDING GITTLine TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

 

 

 

  perform  abschliessen_und_generieren.

endform.

 

* Ende                                                     "PBSW140404

* Anfang                                                   "PBSW230904

form maintain_variant_disp using report struc variant.

  data: s_layout type kkblo_layout.

  data: s_fieldcat type kkblo_t_fieldcat.

  data: fieldcat type slis_t_fieldcat_alv.

  data: layout      type slis_layout_alv.

  data: field type kkblo_fieldcat.

  data: fields type standard table of kkblo_fieldcat.

  data: ls_variant       type disvariant.

  data: ls_ltdxkey type ltdxkey.

  data: x_exit type c.

 

  data: byte_count type i.

 

 

  ls_variant-report = report.

  ls_variant-handle = space.

  ls_variant-variant = variant.

  ls_variant-username = sy-uname.

 

  perform feldkatalog_init_docm in program (report).

  import fieldcat from memory id 'FIELDCAT'.

*

  call function 'REUSE_ALV_TRANSFER_DATA'

    exporting

      it_fieldcat = fieldcat

      is_layout   = layout

    importing

      et_fieldcat = s_fieldcat

      es_layout   = s_layout.

 

 

 

  call function 'LT_VARIANT_LOAD'

    exporting

      i_tabname           = struc

      i_dialog            = 'N'

      i_user_specific     = 'X'

    importing

      et_fieldcat         = s_fieldcat[]

    changing

      cs_layout           = s_layout

      ct_default_fieldcat = s_fieldcat

      cs_variant          = ls_variant

    exceptions

      wrong_input         = 1

      fc_not_complete     = 2

      not_found           = 3

      others              = 4.

 

  byte_count = 1.

  loop at s_fieldcat into field where

         no_out <> 'X' and

         tech   <> 'X' .

    add field-outputlen to byte_count.

    add field-offset to byte_count.

    add 1 to byte_count.

  endloop.

  if byte_count > 1020.

    message w600(fr) with text-l01 text-l02.

  endif.

endform.

* Ende                                                     "PBSW230904

* Anfang                                                   "PBSW011104

form generateexternals_item_cohier using fieldlist type standard table.

 

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XCOHIER.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (Ylips)

  append 'FORM genXCOHIERLine USING COHIERLINE LIKE YCOHIER OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YCOHIER.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

 

 

  perform anonymous_externals_item using 'COHIERLINE' 'YCOHIER'. "PBSW250719

 

 

  append '  MOVE-CORRESPONDING COHIERLine TO TGeneratedHeaderType.'

                  to listing.

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

endform.

 

* Ende                                                     "PBSW011104

 

 

* Anfang                                                   "PBSW230418

form generateexternals_item_pchier using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XPCHIER.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (Ylips)

  append 'FORM genXPCHIERLine USING PCHIERLINE LIKE YPCHIER OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YPCHIER.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

  perform anonymous_externals_item using 'PCHIERLine' 'YPCHIER'. "PBSW250719

 

 

  append '  MOVE-CORRESPONDING PCHIERLine TO TGeneratedHeaderType.'

                  to listing.

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

endform.

 

* Ende                                                     "PBSW230418

 

* Anfang                                                   "PBSW071104

form generateexternals_xmat_stock using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XMAT_STOCK.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (Ylips)

  append

  'FORM genXMATSTOCKLine USING XMATSTOCKLINE LIKE XMAT_STOCK OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE XMAT_STOCK.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

  perform anonymous_externals_item using 'XMATSTOCKLINE' 'XMAT'. "PBSW250719

 

  append '  MOVE-CORRESPONDING XMATSTOCKLINE TO TGeneratedHeaderType.'

                  to listing.

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

endform.

* Ende                                                     "PBSW071104

* Anfang                                                   "PBSW120105

form generateexternals_item_cototal

            using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XCOTOTALS.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (Ylips)

  append

   'FORM genXCOTOTALSLine USING COTOTALSLINE LIKE YCOTOTALS OutLine.'

                                                         to listing.

  append '  DATA Cl LIKE YCOTOTALS.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

  perform anonymous_externals_item using 'COTOTALSLINE' 'YCOTOTALS'. "PBSW250719

 

  append '  MOVE-CORRESPONDING COtotalsline TO TGeneratedHeaderType.'

                  to listing.

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

endform.

* Ende                                                     "PBSW120105

* Anfang                                                   "PBSC090605

*&---------------------------------------------------------------------*

*&      Form  VERWALTUNG

*&---------------------------------------------------------------------*

form verwaltung using x_filename x_dirname  .

* Get an xtrct_uuid

  if p_xtrct_uuid is initial.

    call function 'TXW_UUID_CREATE'

      importing

        txw_uuid = p_xtrct_uuid.

*    Lock id

    call function 'ENQUEUE_/PBS/E_DIE_DIR2'

      exporting

        xtrct_uuid     = p_xtrct_uuid

      exceptions

        foreign_lock   = 1

        system_failure = 2

        others         = 3.

    if sy-subrc = 2.                     "system failure

      message e002(xw) raising lock_system_failure.

    endif.

* show extract id in job log

    if sy-batch = 'X'.

      message s084(xw) with p_xtrct_uuid.

    endif.

    /pbs/die_dir2-xtrct_uuid = p_xtrct_uuid.

  endif.

* set time stamp and other data

*  ID'S eingeben

  /pbs/die_dir2-vol_x2  = volume-x2.

  /pbs/die_dir2-status = 'A'.

  /pbs/die_dir2-jobname = jobname.

  /pbs/die_dir2-jobcount = jobcount.

  /pbs/die_dir2-requser = sy-uname.

  /pbs/die_dir2-seldate = sy-datum.

  /pbs/die_dir2-seltime = sy-uzeit.

  /pbs/die_dir2-saprl = sy-saprl.

  /pbs/die_dir2-host = sy-host.

  /pbs/die_dir2-l_file = dfname.

  /pbs/die_dir2-file_name = x_filename.

  /pbs/die_dir2-txtlg = y_info.

  /pbs/die_dir2-dir_name = x_dirname.

 

* get logical system

  select single * from t000 where mandt = sy-mandt.

  /pbs/die_dir2-logsys = t000-logsys.

  insert /pbs/die_dir2.

  if not sy-subrc is initial.

    message x016(xw).    "Kurzdump

  endif.

endform.                    " VERWALTUNG

*&---------------------------------------------------------------------*

*&      Form  verwaltung_size

*&---------------------------------------------------------------------*

form verwaltung_size  using    p_outfile

                               p_dirname.

  data: x_strlength type i,

        x_filename  like /pbs/die_dir2-l_file,

        x_dirname   like /pbs/die_dir2-dir_name.

  x_strlength = strlen( p_dirname ).

  x_filename = p_outfile+x_strlength.

  x_strlength = x_strlength - 1.

  x_dirname = p_outfile(x_strlength).

  clear extr_len.

  call 'C_DIR_READ_FINISH'    .        " just to be sure

*     ID 'ERRNO'  FIELD file_list-errno

*     ID 'ERRMSG' FIELD file_list-errmsg.

 

  call 'C_DIR_READ_START' id 'DIR'    field x_dirname

                           id 'FILE'   field x_filename.

*                          ID 'ERRNO'  FIELD file_list-errno

*                          ID 'ERRMSG' FIELD file_list-errmsg.

 

 

  call 'C_DIR_READ_NEXT'

         id 'LEN'    field extr_len.

  /pbs/die_dir2-file_size = extr_len.

  update /pbs/die_dir2

              set file_size = extr_len

                where xtrct_uuid = p_xtrct_uuid

                  and vol_x2     = volume-x2.

 

endform.                    " verwaltung_size

* Ende                                                     "PBSC090605

* Anfang                                                   "PBSW300408

********************************************************************

*  FORM: generateExternals

********************************************************************

*  PARAMETERS:

*    FieldList   [in]: Feldbeschreibungen der Variante

********************************************************************

*  generiert ein externes Programm, in dem die gewünschte Struktur

*  und die erforderlichen FORMS erzeugt werden:

*    FORM genBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> YBSEG

*    FORM genXBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> XBSEG

*    FORM modifyTimeDate: konvertiert Datum und Zeit in das von AIS

*                         geforderte Format

********************************************************************

form generateexternals_ais_tab using fieldlist type standard table.

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XAIS.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (Ylips)

  append 'FORM genXAISTABLine USING CAISTABLINE LIKE YAISTAB OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YAISTAB.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

  append '  MOVE-CORRESPONDING CAISTABLine TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

 

 

 

  perform  abschliessen_und_generieren.

endform.

 

 

 

 

********************************************************************

*  FORM: generateExternals

********************************************************************

*  PARAMETERS:

*    FieldList   [in]: Feldbeschreibungen der Variante

********************************************************************

*  generiert ein externes Programm, in dem die gewünschte Struktur

*  und die erforderlichen FORMS erzeugt werden:

*    FORM genBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> YBSEG

*    FORM genXBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> XBSEG

*    FORM modifyTimeDate: konvertiert Datum und Zeit in das von AIS

*                         geforderte Format

********************************************************************

form generateexternals_ais_fld using fieldlist type standard table.

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XAIS.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (Ylips)

  append 'FORM genXAISFLDLine USING CAISFLDLINE LIKE YAISFLD OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YAISFLD.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

  append '  MOVE-CORRESPONDING CAISFLDLine TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

 

 

 

  perform  abschliessen_und_generieren.

endform.

 

* Ende                                                     "PBSW300408

 

* Anfang                                                   "PBSW040210

********************************************************************

*                                                                  *

*                                                                  *

*   Generierung Extraktstring für Istposten Abstimmledger COFIS    *

*                                                                  *

*                                                                  *

********************************************************************

 

form generateexternals_xbset using fieldlist type standard table.

 

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XBSET.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '  '.

 

 

* Form 1 Start: Erzeugung der gefüllten Zeile (YBSET)

  append 'FORM genBSETLine USING XBSETLine LIKE YBSET  OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YBSET. ' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

  append '  MOVE-CORRESPONDING XBSETLine TO TGeneratedHeaderType.'

                  to listing.

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

 

endform.

* Ende                                                     "PBSW040210

 

* Anfang                                                   "PBSW311005

form generateexternals_text using fieldlist type standard table.

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  if syst-cprog eq '/PBS/CFI_LIS_TEXT'.

    append 'INCLUDE /PBS/CFI_LIS_STRU_XTEXT.' to listing.

  else.

    append 'INCLUDE /PBS/CFI_LIS_STRU_XTEXT.' to listing.

  endif.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (YBSEG)

  append 'FORM genTEXTLine USING TEXTLine LIKE YTEXT OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YTEXT.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

  append '  MOVE-CORRESPONDING TEXTLINE TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

endform.

 

* Ende                                                     "PBSW311005

 

 

* Anfang PBSC030810

*&---------------------------------------------------------------------*

*&      Form  GENERATEEXTERNALS_ITEM_BSET

*&---------------------------------------------------------------------*

form generateexternals_item_bset  using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_STRU_XBSET.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (YBSET]

  append 'FORM genBSETLine USING BSETLINE LIKE YBSET OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE YBSET.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

  perform anonymous_externals_item using 'BSETLine' 'YBSET'. "PBSW250719

 

 

  append '  MOVE-CORRESPONDING BSETLine TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

  perform  abschl_und_gen_bset.

endform.                    " GENERATEEXTERNALS_ITEM_BSET

*&---------------------------------------------------------------------*

*&      Form  ABSCHL_UND_GEN_BSET

*&---------------------------------------------------------------------*

form abschl_und_gen_bset .

  perform append_listing.

  generate subroutine pool listing name generatedprog_bset

      line errorline message errormessage.

  if sy-subrc <> 0.

* Programm konnte nicht generiert werden

*   MESSAGE E600 WITH TEXT-017.                           "PBSW151104

* Anfang                                                   "PBSW100408

    message i600(fr) with errormessage+000(50)

                          errormessage+050(50)

                          errormessage+100(50)

                          errormessage+150(50).

* Ende                                                     "PBSW100408

 

    message e600(fr) with text-017.                         "PBSW151104

  endif.

endform.                    " ABSCHL_UND_GEN_BSET

* Ende PBSC030810

 

 

 

*Anfang                                                    "PBSW250719

 

form get_anonymous_values.

*   Soll generell anonymisiert werden

  if h_anonym eq 'AG'.

    /pbs/cfi_cl_an=>set_anonymous_extr  = 'X'.

  elseif h_anonym eq 'AP'.

    /pbs/cfi_cl_an=>set_anonymous_extr  = 'X'.

  elseif h_anonym eq space.

    /pbs/cfi_cl_an=>set_anonymous_extr  = space.

  endif.

  anonymous = /pbs/cfi_cl_an=>set_anonymous_extr.

endform.

 

form anonymous_externals_xtab.

  append  'data: ano_first type char1.' to listing.

  append  'FIELD-SYMBOLS: <gr_line> TYPE any. ' to listing.

  append  'FIELD-SYMBOLS: <feld> TYPE simple.' to listing.

  append  'data:  bl_tab type dd02l-tabname value ''/PBS/CFI_BL''. ' to listing.

  append  'data: i_tab_cfi_bl type TABLE OF /pbs/cfi_bl.' to listing.

  append  'data  i_lin_cfi_bl like line of i_tab_cfi_bl.' to listing.

  append  'dATA: REFTAB LIKE DD02L-TABNAME.' to listing.

  append  'data: field_type type char1.' to listing.

  append  'data: field_length type i.' to listing.

  append  'data: pa_tab TYPE string.' to listing.

  append  'data: gr_line type ref to data.' to listing.

  append  'DATA: BEGIN OF source OCCURS 10,' to listing.

  append  'LINE(72),' to listing.

  append  'END   OF source.' to listing.

  append  'data: source_line type char72.' to listing.

  append  'data: r_name  type trdir-name.' to listing.

  append  'data: anonymous type char1.' to listing.

  append  'data: replace_char type char1.' to listing.

 

 

  append  ' anonymous = /PBS/CFI_CL_AN=>set_anonymous_extr.' to listing.

  append  ' if anonymous <> space.' to listing.

 

  append  'class: /PBS/CFI_CL_AN DEFINITION load.' to listing.

  append  'ano_first = /PBS/CFI_CL_AN=>set_first.' to listing.

  append  'if ano_first eq space.' to listing.

  append  '/PBS/CFI_CL_AN=>set_first = ''X''.' to listing.

  append  'if sy-cprog eq ''/PBS/CFI_LIS_REFERENCE''.' to listing.

  append  ' concatenate sy-cprog ''_INIT'' into r_name.' to listing.

  append  ' READ REPORT r_name INTO source. ' to listing.

  append  ' loop at source  into source_line' to listing.

  append  ' where line cs ''REFTAB''.' to listing.

  append  'EXIT.' to listing.

  append  ' endloop.' to listing.

  append  ' replace ''REFTAB'' with space into source_line.' to listing.

  append  'replace ''='' with space into source_line. ' to listing.

  append  'condense source_line no-gaps.' to listing.

  append 'write source_line(1) to replace_char.' to listing.

  append  'replace all OCCURRENCES OF replace_char in source_line with space.' to listing.

  append  'replace all OCCURRENCES OF ''.'' in source_line with space.' to listing.

  append  'write source_line to REFTAB.' to listing.

  append  'Select * from (bl_tab) into CORRESPONDING FIELDS OF TABLE ' to listing.

*  append  'i_tab_cfi_Bl where tabellenname eq reftab and version eq 1.' to listing.

  append  'i_tab_cfi_Bl where tabellenname eq reftab.' to listing.

  append  'else.' to listing.

  append  'select tabellenname from /PBS/CFI_BL_STRU into ' to listing.

  append  'pa_tab where name eq sy-cprog.' to listing.

  append  'Select * from (bl_tab) into CORRESPONDING FIELDS OF TABLE' to listing.

*  append  'i_tab_cfi_Bl where tabellenname eq pa_tab and version eq 1.' to listing.

  append  'i_tab_cfi_Bl where tabellenname eq pa_tab.' to listing.

  append  'endselect.' to listing.

  append  'endif.' to listing.

  append  '/PBS/CFI_CL_AN=>SET_BL_TABLE = i_tab_cfi_bl.' to listing.

  append  'ELSE.' to listing.

  append  '  i_tab_cfi_Bl = /PBS/CFI_CL_AN=>set_bl_table.' to listing.

  append  'endif.' to listing.

  append  '  pa_tab = ''XTABLine''.' to listing.

  append  '  assign (pa_tab) to <gr_line>. ' to listing.

  append  '  loop at i_tab_cfi_bl into i_lin_cfi_bl.' to listing.

  append  '  assign component i_lin_cfi_bl-feldname of structure' to listing.

  append  '  <gr_line> to <feld>.' to listing.

  append  '  clear <feld>.  ' to listing.

  append  '  describe field <feld> type field_Type. ' to listing.

  append  '  case field_type. ' to listing.

  append  '  when ''C''. ' to listing.

  append  '  describe field <feld> length field_length in CHARACTER MODE. ' to listing.

  append  '  translate <Feld> using '' X''. ' to listing.

  append  '  when others. ' to listing.

  append  '  clear <feld>. ' to listing.

  append  '  endcase. ' to listing.

  append  '  endloop. ' to listing.

 

  append  ' endif.' to listing.

endform.

 

form anonymous_externals_item using line stru.

  class: /pbs/cfi_cl_an definition load.

  /pbs/cfi_cl_an=>set_extract_line = line.

  /pbs/cfi_cl_an=>set_extract_segm = stru.

  append  'data: ano_first type char1.' to listing.

  append  'FIELD-SYMBOLS: <gr_line> TYPE any. ' to listing.

  append  'FIELD-SYMBOLS: <feld> TYPE simple.' to listing.

  append  'data:  bl_tab type dd02l-tabname value ''/PBS/CFI_BL''. ' to listing.

  append  'data: x_line type char30.' to listing.

  append  'data: x_stru type char30.' to listing.

  append  'data: i_tab_cfi_bl type TABLE OF /pbs/cfi_bl.' to listing.

  append  'data  i_lin_cfi_bl like line of i_tab_cfi_bl.' to listing.

  append  'data: field_type type char1.' to listing.

  append  'data: field_length type i.' to listing.

  append  'data: pa_tab TYPE string.' to listing.

  append  'data: gr_line type ref to data.' to listing.

  append  'data: anonymous type char1.' to listing.

  append  'data: h_fieldname type /PBS/CFI_BL-Feldname. ' to listing.

 

 

  append  ' anonymous = /PBS/CFI_CL_AN=>set_anonymous_extr.' to listing.

  append  ' if anonymous <> space.' to listing.

 

 

  append  'class: /PBS/CFI_CL_AN DEFINITION load.' to listing.

  append  'ano_first = /PBS/CFI_CL_AN=>set_first.' to listing.

  append  'if ano_first eq space.' to listing.

  append  '/PBS/CFI_CL_AN=>set_first = ''X''.' to listing.

  append  'x_stru = /PBS/CFI_CL_AN=>set_extract_Segm.' to listing.

  append ' select  /PBS/CFI_BL_STRU~tabellenname ' to listing.

  append '        /PBS/CFI_BL_STRU~extension ' to listing.

  append '        /PBS/CFI_BL~feldname ' to listing.

  append '      from /PBS/CFI_BL_STRU inner join /PBS/CFI_BL ' to listing.

  append '      on ' to listing.

  append '       /PBS/CFI_BL_STru~tabellenname eq /PBS/CFI_BL~Tabellenname ' to listing.

  append '    into corresponding fields of i_lin_Cfi_bl ' to listing.

  append '  where /PBS/CFI_BL_stru~NAME eq sy-cprog ' to listing.

*  append '     and   /pbs/CFI_BL_stru~segment eq ''YBSEG'' ' to listing.      "<--- SPECIFIC

  append '     and   /pbs/CFI_BL_stru~segment eq x_Stru. ' to listing.          "<--- SPECIFIC

*  append '     and   /pbs/cfi_bl~version eq 1. ' to listing.

  append  'append  i_lin_cfi_bl to i_tab_cfi_bl.' to listing.

  append ' endselect.' to listing.

  append  ' sort i_tab_cfi_bl.' to listing.

  append  '/PBS/CFI_CL_AN=>SET_BL_TABLE = i_tab_cfi_bl.' to listing.

  append  'ELSE.' to listing.

  append  '  i_tab_cfi_Bl = /PBS/CFI_CL_AN=>set_bl_table.' to listing.

  append  'endif.' to listing.

*  APPEND  '  pa_tab = ''BSEGLine''.' to listing.                              "<--- Specific

  append   ' pa_tab = /PBS/CFI_CL_AN=>set_extract_line.' to listing.            "<--- specific

 

  append  '  assign (pa_tab) to <gr_line>. ' to listing.

 

*Anfang                                                                         "PBSW041019

  if stru eq 'YCDPOS'.

    append ' tables: /PBS/CFI_BL.' to listing.

    append ' select single * from /PBS/CFI_BL where' to listing.

    append ' tabellenname eq cdposline-tabname and' to listing.

    append ' feldname     eq cdposline-fname.' to listing.

    append ' if sy-subrc eq 0.               ' to listing.

 

  endif.

*Ende                                                                           "PBSW041019

 

 

 

 

 

  append  '  loop at i_tab_cfi_bl into i_lin_cfi_bl.' to listing.

  append  '  concatenate i_lin_cfi_bl-feldname i_lin_cfi_bl-extension' to listing.

  append  '  into h_fieldname.' to listing.

  append  '  assign component h_fieldname of structure' to listing.

  append  '  <gr_line> to <feld>.' to listing.

  append  '  clear <feld>.  ' to listing.

  append  '  describe field <feld> type field_Type. ' to listing.

  append  '  case field_type. ' to listing.

  append  '  when ''C''. ' to listing.

  append  '  describe field <feld> length field_length in CHARACTER MODE. ' to listing.

  append  '  translate <Feld> using '' X''. ' to listing.

  append  '  when others. ' to listing.

  append  '  clear <feld>. ' to listing.

  append  '  endcase. ' to listing.

  append  '  endloop. ' to listing.

*Anfang                                                                         "PBSW041019

  if stru eq 'YCDPOS'.

    append 'ENDIF.' to listing.

  endif.

*

*Ende                                                                           "PBSW041019

  append  ' endif.' to listing.

 

endform.

 

 

form set_status_anonymous.

* Ist die Anonymisierung aktiv.

  if h_anonym <> space.

*   Soll generell anonymisiert werden

    if h_anonym eq 'AG'.

      /pbs/cfi_cl_an=>set_anonymous_extr  = 'X'.

    endif.

* Sollen nur Belege eines Prozesse anonymisiert werden ?

    if h_anonym eq 'AP'.

      select count(*) from /pbs/cfi_bl_doc up to 1 rows

         where bukrs eq anonym_buf-bukrs

         and   belnr eq anonym_buf-belnr

         and   gjahr eq anonym_buf-gjahr

         and   aktiv eq 'Y'

         and   gueltig_Bis ge sy-datum.

      if sy-dbcnt > 0.

*               anonymous = 'X'.

        /pbs/cfi_cl_an=>set_anonymous_extr  = 'X'.

      else.

*               anonymous = space.

        /pbs/cfi_cl_an=>set_anonymous_extr  = space.

      endif.

 

    endif.

  else.

    anonymous = space.

    /pbs/cfi_cl_an=>set_anonymous_extr  = space.

  endif.

 

endform.

 

 

 

 

*Ende                                                      "PBSW250719

*Anfang                                                    "PBSW150824

********************************************************************

*  FORM: generateExternals

********************************************************************

*  PARAMETERS:

*    FieldList   [in]: Feldbeschreibungen der Variante

********************************************************************

*  generiert ein externes Programm, in dem die gewünschte Struktur

*  und die erforderlichen FORMS erzeugt werden:

*    FORM genBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> YBSEG

*    FORM genXBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> XBSEG

*    FORM modifyTimeDate: konvertiert Datum und Zeit in das von AIS

*                         geforderte Format

********************************************************************

form generateexternals_txw_mm_pos using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_TXW_STRU_MAT_BEL.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (YMSEG)

  append 'FORM genTXWMMPOSLine USING MMPOSLINE LIKE MMPOS OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE MMPOS.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

*

  perform anonymous_externals_item using 'MMPOSLINE' 'MMPOS'. "PBSW250719

 

 

 

  append '  MOVE-CORRESPONDING MMPOSLINE TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

 

 

 

  perform  abschliessen_und_generieren.

endform.

 

********************************************************************

*  FORM: generateExternals

********************************************************************

*  PARAMETERS:

*    FieldList   [in]: Feldbeschreibungen der Variante

********************************************************************

*  generiert ein externes Programm, in dem die gewünschte Struktur

*  und die erforderlichen FORMS erzeugt werden:

*    FORM genBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> YBSEG

*    FORM genXBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> XBSEG

*    FORM modifyTimeDate: konvertiert Datum und Zeit in das von AIS

*                         geforderte Format

********************************************************************

form generateexternals_txw_mm_hd using fieldlist type standard table.

  perform get_anonymous_values.                             "PBSW250719

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_TXW_STRU_MAT_BEL.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (YMSEG)

  append 'FORM genTXWMMHDLine USING MMHDLINE LIKE MMHD OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE MMHD.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

 

*

  perform anonymous_externals_item using 'MMPOSLINE' 'MMHD'. "PBSW250719

 

 

 

  append '  MOVE-CORRESPONDING MMHDLINE TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

 

 

 

  perform  abschliessen_und_generieren.

endform.

 

*Ende                                                      "PBSW150824

*Anfang                                                    "PBSC091024

********************************************************************

*  FORM: generateExternals

********************************************************************

*  PARAMETERS:

*    FieldList   [in]: Feldbeschreibungen der Variante

********************************************************************

*  generiert ein externes Programm, in dem die gewünschte Struktur

*  und die erforderlichen FORMS erzeugt werden:

*    FORM genBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> YBSEG

*    FORM genXBSEGLine:    weist die erforderlichen Felder der

*                         generierten Struktur zu und schreibt sie

*                         in Textform nach (param2) -> XBSEG

*    FORM modifyTimeDate: konvertiert Datum und Zeit in das von AIS

*                         geforderte Format

********************************************************************

form generateexternals_txw_co_pos using fieldlist type standard table.

  perform get_anonymous_values.

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_TXW_STRU_CO.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (YCOEP)

  append 'FORM genTXWCOPOSLine USING COPOSLINE LIKE COPOS OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE COPOS.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

*

  perform anonymous_externals_item using 'COPOSLINE' 'COPOS'.

 

  append '  MOVE-CORRESPONDING COPOSLINE TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

 

  perform  abschliessen_und_generieren.

endform.

 

********************************************************************

*  FORM: generateExternals

********************************************************************

*  PARAMETERS:

*    FieldList   [in]: Feldbeschreibungen der Variante

********************************************************************

*  generiert ein externes Programm, in dem die gewünschte Struktur

*  und die erforderlichen FORMS erzeugt werden:

********************************************************************

form generateexternals_txw_co_hd using fieldlist type standard table.

  perform get_anonymous_values.

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_TXW_STRU_CO.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (YCOBK)

  append 'FORM genTXWCOHDLine USING COHDLINE LIKE COHD OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE COHD.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

*

  perform anonymous_externals_item using 'COHDLINE' 'COHD'.

 

  append '  MOVE-CORRESPONDING COHDLINE TO TGeneratedHeaderType.'

                  to listing.

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

endform.

*

form generateexternals_txw_co_pos_1 using fieldlist type standard table.

  perform get_anonymous_values.

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_TXW_STRU_CO.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (YCOEP)

  append 'FORM genTXWCOPOSLine USING COPOSLINE LIKE COPOS OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE COPOS.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

*

  perform anonymous_externals_item using 'COPOSLINE' 'COPOS'.

 

  append '  MOVE-CORRESPONDING COPOSLINE TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

 

  perform  abschliessen_und_generieren.

endform.

form generateexternals_txw_co_shd using fieldlist type standard table.

  perform get_anonymous_values.

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_TXW_STRU_CO.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (YCOBK)

  append 'FORM genTXWCOSHDLine USING COSHDLINE LIKE COSHD OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE COSHD.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

*

  perform anonymous_externals_item using 'COSHDLINE' 'COSHD'.

 

  append '  MOVE-CORRESPONDING COSHDLINE TO TGeneratedHeaderType.'

                  to listing.

  perform  datum_uhrzeit_uebernehmen.

  perform  abschliessen_und_generieren.

endform.

*

form generateexternals_txw_co_spos using fieldlist type standard table.

  perform get_anonymous_values.

 

* Programm-Header

  append 'PROGRAM SUBPOOL.' to listing.

  append 'FIELD-SYMBOLS: <TypeFieldSymbol> TYPE ANY.' to listing.

  append 'INCLUDE /PBS/CFI_LIS_TXW_STRU_CO.' to listing.

  perform datum_und_uhrzeit_aufbereiten.

  perform  header_und_ausgabelaenge using '_K'.

 

* Form 1 Start: Erzeugung der gefüllten Zeile (YCOEP)

  append 'FORM genTXWCOSPOSLine USING COSPOSLINE LIKE COSPOS OutLine.'

                                                     to listing.

  append '  DATA Cl LIKE COSPOS.' to listing.

  append '  CLEAR Cl.' to listing.

  append '  MOVE-CORRESPONDING Cl TO TGeneratedHeaderType.' to listing.

*

  perform anonymous_externals_item using 'COSPOSLINE' 'COSPOS'.

 

  append '  MOVE-CORRESPONDING COSPOSLINE TO TGeneratedHeaderType.'

                  to listing.

 

  perform  datum_uhrzeit_uebernehmen.

 

  perform  abschliessen_und_generieren.

endform.

*Ende                                                      "PBSC091024

 

 

 

 

*INCLUDE /PBS/CFI_LIS_T001_INIT.

FORM INIT_TAB.

REFTAB = 'T001'.

ONE_TAB = 'X'.

ENDFORM .

*INCLUDE /PBS/CFI_LIS_AIS_T009_INIT.

*INCLUDE /PBS/CFI_LIS_REFERENCE_INIT.

INITIALIZATION.

X_APPLIC = 'CFI'.                                          "PBSC060505

PERFORM INIT_TAB.

VARI_LIS = '/PBS/GDPBS_1'.

X_LIST = 'X'.

 

DATASET_CHECK_ONCE = SPACE.

 

 

*Anfang                                                   "PBSW160217

* Check authority for SE16

* CALL FUNCTION 'AUTHORITY_CHECK_TCODE'

*       EXPORTING

*            TCODE  = 'SE16'

*       EXCEPTIONS

*            OK     = 0

*            OTHERS = 4.

*IF SYST-SUBRC <> 0.

*       MESSAGE ID 'FR'  TYPE 'E' NUMBER '600'

**                                        WITH TEXT-010.     "PBSC210606

*                                         WITH TEXT-999.     "PBSC210606

*ENDIF.

*Ende                                                       "PBSW160217

 

*Anfang                                                     "PBSW181002

AT SELECTION-SCREEN OUTPUT.

ABDATM_FLG = SPACE.

LOOP AT SCREEN.

* Anfang                                                    "PBSC060505

   IF SCREEN-GROUP1 EQ 'KN1'.

      SCREEN-INPUT     = 0.

      if X_ADM is initial.

         SCREEN-INVISIBLE = 1.

      endif.

      MODIFY SCREEN.

   ENDIF.

   IF SCREEN-GROUP1 EQ 'KN2'.

      if X_ADM is initial.

         SCREEN-INPUT     = 0.

         SCREEN-INVISIBLE = 1.

      endif.

      MODIFY SCREEN.

   ENDIF.

   IF SCREEN-NAME CS 'DIRNAME' and

            x_adm eq 'X' .

      IF not x_archid is initial

         or not x_pfad is initial.

         SCREEN-INPUT = 0.

         MODIFY SCREEN.

      ENDIF.

   ENDIF.

* Ende                                                      "PBSC060505

IF SCREEN-NAME EQ 'AUTOMAT'.

    ABDATM_FLG = 'X'.

    ARCH_SEL   = 'X'.

ENDIF.

IF SCREEN-NAME CS 'ARCHLIST'.

    ABDATM_FLG = SPACE.

ENDIF.

IF ABDATM_FLG = 'X'. "AND SCREEN-NAME <> 'ABDATM'.

    SCREEN-INVISIBLE = '1'.

    SCREEN-INPUT     = '0'.

    MODIFY SCREEN.

ENDIF.

ENDLOOP.

 

IF ARCH_SEL EQ 'X'.

   LOOP AT SCREEN.

    IF SCREEN-GROUP1 EQ 'ARC'.

       SCREEN-INVISIBLE = '0'.

       SCREEN-INPUT     = '1'.

       MODIFY SCREEN.

    ENDIF.

   ENDLOOP.

ELSE.

   LOOP AT SCREEN.

    IF SCREEN-GROUP1 EQ 'ARC'.

       SCREEN-INVISIBLE = '1'.

       SCREEN-INPUT     = '0'.

       MODIFY SCREEN.

    ENDIF.

   ENDLOOP.

 

ENDIF.

*Ende

 

  DATA: ABDATM_FLG(1) TYPE C.

 

 

AT SELECTION-SCREEN ON PA_NMAX.

    IF SY-CALLD EQ SPACE.

    IF PA_NMAX EQ 0 OR

       PA_NMAX GE 1000000000.

       MESSAGE ID 'FR'  TYPE 'W' NUMBER '600' WITH TEXT-010.

    ENDIF.

    ENDIF.

AT SELECTION-SCREEN ON VALUE-REQUEST FOR VARI_LIS.

  PERFORM ALV_VARIANT_F4_LIS CHANGING VARI_LIS.

 

AT SELECTION-SCREEN.

if not reftab is initial.                                    "PBSW100707

   perForm authority_check_tab using reftab syst-subrc.      "PBSW100707

endif.                                                       "PBSW100707

Y_AUTO = X_AUTO.                                             "PBSC060505

VARIANT-HANDLE = SPACE.

* PBSY start

* Anfang                                                     "PBSW121104

IF P_CONV <> SPACE.

   y_conv = p_conv. "Only when bw extract possible          "PBSC060505

   EXP = 'X'.

   P_CONV = SPACE.

   PERFORM PRUEFE_DATEI_PFAD.

   P_CONV = 'X'.

   EXP = SPACE.

ENDIF.

* Endif                                                      "PBSW121104

if exp <> SPACE.                                             "PBSC060505

   PERFORM PRUEFE_DATEI_PFAD.

endif.                                                       "PBSC060505

perform node_handling.                                       "PBSC060505

 

START-OF-SELECTION.

*

if h_exlang is not initial. sy-langu = h_exlang.endif.       "PBSW210819

y_conv = p_conv. "Only when bw extract possible              "PBSC060505

PERFORM CHECK_KNOTEN changing x_message.                     "PBSC060505

if not x_message is initial.                                 "PBSC060505

  MESSAGE ID '/PBS/UTIL' TYPE 'S' NUMBER X_MESSAGE.          "PBSC060505

  exit.                                                      "PBSC060505

endif.                                                       "PBSC060505

*

IF ONE_TAB EQ 'X'.                                           "PBSC040707

PERFORM GET_JOBNAME.                  "PBSC060505"PBSC110107"PBSC040707

ELSE.                                                        "PBSC040707

PERFORM GET_UUID.                                            "PBSC110107

ENDIF.                                                       "PBSC040707

* Anfang                                                     "PBSW121104

* SET FLAG for BW-Extract request to an interal value.

IF NOT P_CONV IS INITIAL.

       P_CONV = SPACE.

       EXP    = 'X'.

       X_BW   = 'X'.

ENDIF.

* Ende                                                       "PBSW121104

* Anfang                                                     "PBSW231003

READ REPORT SY-CPROG  INTO ABAP_TAB.

SEARCH ABAP_TAB FOR '/PBS/CFI_LIS_REFERENCE_STRU'.

READ TABLE ABAP_TAB INDEX SYST-TABIX.

IF ABAP_TAB(1) <> '*'.

   INCL_NAME = ABAP_TAB.

ELSE.

   SYST-TABIX = SYST-TABIX - 1.

   READ TABLE ABAP_TAB INDEX SYST-TABIX.

   INCL_NAME = ABAP_TAB.

ENDIF.

free abap_tab.

* Ende                                                       "PBSW231003

 

PERFORM INIT_TAB.

 

XTABCOUNT = 0.

NUMEXTRACTEDPOSITIONS = 0.

 

 

IF SYST-BATCH <> SPACE.

    IF PA_NMAX EQ 0 OR

       PA_NMAX GE 999999999.

*      MESSAGE ID 'FR'  TYPE 'W' NUMBER '600' WITH TEXT-010.

    ENDIF.

ENDIF.

 

 

VARIANT-HANDLE = SPACE.

VARIANT-VARIANT = VARI_LIS.

* Anfang                                                     "PBSC060505

* Ergänze Dateiname

IF  EXP EQ 'X' AND X_AUTO EQ  'X'.

   CONCATENATE DFNAME '_' SYST-DATUM '_' SYST-UZEIT INTO DFNAME.

* Anfang                                                    "PBSW100107

         IF DFNAME(1) EQ '_'. SHIFT DFNAME BY 1 PLACES LEFT.ENDIF.

            CONDENSE DFNAME NO-GAPS.

 

* Ende                                                      "PBSW100107

   PERFORM BUILDFILENAME USING DIRNAME DFNAME OUTFILE.

ELSEIF DISPPRNT EQ SPACE.

* Anfang                                                    "PBSW100107

         IF DFNAME(1) EQ '_'. SHIFT DFNAME BY 1 PLACES LEFT.ENDIF.

            CONDENSE DFNAME NO-GAPS.

* Ende                                                      "PBSW100107

 

   PERFORM BUILDFILENAME USING DIRNAME DFNAME OUTFILE.

ENDIF.

* Ende                                                       "PBSC060505

********************************************************************

* Öffene Datei wenn extrakt gewünscht.                             *

********************************************************************

* IF EXP <> SPACE.                                          "PBSW121104

  IF DISPPRNT EQ SPACE.                                     "PBSW121104

     PERFORM CREATEOUTPUTFILE USING OUTFILE SUCCESS.

     IF SUCCESS = ' '.

*       Datei konnte nicht geöffnet werden

        MESSAGE E600 WITH TEXT-016.

        EXIT.

      ENDIF.

  ENDIF.

 

********************************************************************

*  Inintialisierung Datenextrakt / Listausgabe                     *

********************************************************************

 

GS_PRINT-NO_PRINT_LISTINFOS = C_X.

*VARIANT-REPORT         = '/PBS/CFI_LIS_REFERENCE'.         "PBSW070703

VARIANT-REPORT         = SYST-REPID.                        "PBSW070703

VARIANT-USERNAME       = SY-UNAME.

PERFORM DEFINE_STRUCTURES_DISPLAY.

PERFORM FELDKATALOG_INIT_DOCM.

PERFORM PREPARE_LIST_DISPLAY.

EX_TABNAME = 'XTAB'.

PERFORM GENERATE_VARIANT.

 

 

 

 

IF EXP = 'X'.

 

   PERFORM GETVARIANTFIELDS USING FIELDLIST[].

   PERFORM GENERATEEXTERNALS_XTAB USING FIELDLIST[].

   PERFORM WRITEOUTPUTHEADER USING FIELDLIST[] '  '.

   PERFORM SET_CORRECT_TAB_VALUE IN PROGRAM (GENERATEDPROG).

 

ENDIF.

 

IF X_ARCH EQ SPACE.                        "PBSW181002

PERFORM DB_SELE.                           "PBSW181002

ENDIF.                                     "PBSW181002

 

*INCLUDE /PBS/CFI_LIS_T001_SEL_A.

*INCLUDE /PBS/CFI_LIS_AIS_T009_SEL_A.

*INCLUDE /PBS/CFI_LIS_REFERENCE_SEL_A.      "PBSW181002

 

 

 

END-OF-SELECTION.

 

IF P_STOP = 'X'.

    MESSAGE I023(MSITEM) WITH PA_NMAX.

ENDIF.

 

GS_PRINT-NO_PRINT_LISTINFOS = C_X.

 

 

IF EXP = 'X'. "PBSY

  CLOSE DATASET OUTFILE."PBSY

ENDIF."PBSY

 

* testcode end PBSY

 

IF EXP = 'X' AND GENERATEDPROG <> ''.

  PERFORM OUTPUTSTATISTICS.

ELSE.

  PERFORM LIST_DISPLAY.

ENDIF.

*

IF ONE_TAB EQ 'X'.                                           "PBSC040707

  PERFORM CHECK_SPOOL.                 "PBSC060505"PBSC110107"PBSC040707

ELSE.                                                        "PBSC040707

  PERFORM UPDATE_OHNE_SPOOL.                                 "PBSC110107

ENDIF.                                                       "PBSC040707

******************************************************************

FORM FELDKATALOG_INIT_DOCM.

 

  DATA: BEGIN OF LT_X031L OCCURS 40.

          INCLUDE STRUCTURE X031L.

  DATA: END OF LT_X031L.

  DATA: HELP_FIELDNAME LIKE LT_X031L-FIELDNAME.

* Anfang PBSC240111

  IF REFTAB IS INITIAL.

     PERFORM INIT_TAB.

  ENDIF.

* Ende   PBSC240111

* Felder BSID

  free memory.                                             "#EC *

  REFRESH: FIELDCAT, FIELDCAT_T.

  CALL FUNCTION 'REUSE_ALV_FIELDCATALOG_MERGE'

       EXPORTING

*           I_PROGRAM_NAME         = '/PBS/CFI_LIS_REFERENCE'"PBSW070703

            I_PROGRAM_NAME         = SYST-REPID              "PBSW070703

            I_INTERNAL_TABNAME     = 'XTAB'

            I_STRUCTURE_NAME       = 'TXW_COMPC'

        CHANGING

            CT_FIELDCAT            = FIELDCAT_T

       EXCEPTIONS

            INCONSISTENT_INTERFACE = 1

            PROGRAM_ERROR          = 2

            OTHERS                 = 3.

  IF SY-SUBRC <> 0.

    MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO

            WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.

  ENDIF.

* Anfang                                                     "PBSW030707

 

loop at fieldcat_t into fieldcat_wa where key <> space.

   fieldcat_wa-key = space.

   modify fieldcat_t from fieldcat_wa.

endloop.

 

 

 

* ende                                                       "PBSW030707

 

  APPEND LINES OF FIELDCAT_T TO FIELDCAT.

 

* include correct currency type reference fields for currency fields:

  CALL FUNCTION 'DDIF_NAMETAB_GET'

       EXPORTING

            TABNAME   = REFTAB

       TABLES

            X031L_TAB = LT_X031L

       EXCEPTIONS

            NOT_FOUND = 1

            OTHERS    = 2.

  IF SY-SUBRC <> 0.

    MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO

            WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.

  ENDIF.

 

EXPORT FIELDCAT TO MEMORY ID 'FIELDCAT'.                  "PBSC240111

 

ENDFORM.                               " FELDKATALOG

FORM LIST_DISPLAY.

 

  DATA: L_LINES_MISSING_AUTH TYPE I,

        L_MISSING_LINES(70),

        L_PERFORM.

  DATA: L_SAVE(1) TYPE C VALUE C_A.    "Authority to save? "PBSW030901

 

 

  L_PERFORM = C_YES.

 

  DESCRIBE TABLE GT_MISSING_AUTH LINES L_LINES_MISSING_AUTH.

 

  IF L_LINES_MISSING_AUTH > 0.

    LOOP AT GT_MISSING_AUTH.

      CONCATENATE L_MISSING_LINES GT_MISSING_AUTH

                  INTO L_MISSING_LINES

                  SEPARATED BY SPACE.

    ENDLOOP.

 

    CALL FUNCTION 'POPUP_TO_CONFIRM_WITH_MESSAGE'

         EXPORTING

              DIAGNOSETEXT1  = TEXT-030

              DIAGNOSETEXT2  = L_MISSING_LINES

              TEXTLINE1      = TEXT-031

              TITEL          = TEXT-032

              CANCEL_DISPLAY = ' '

         IMPORTING

              ANSWER         = L_PERFORM

              .

  ENDIF.

 

  IF L_PERFORM = C_YES.

 

    PERFORM CHECK_LAYOUT_AUTH USING L_SAVE L_SAVE.

 

*   Anfang                                                  "PBSW050504

*   Modify output if to much fields for display.

    loop at fieldcat into fieldcat_wa.

          if sy-tabix > 20.

          fieldcat_wa-key    = space.

          endif.

          if sy-tabix > 90.

           fieldcat_wa-no_out = 'X'.

          endif.

          modify fieldcat from fieldcat_wa.

    endloop.

*   Endif                                                   "PBSW050504

 

 

        clear exituser.                                     "PBSC060505

        CALL FUNCTION 'REUSE_ALV_LIST_DISPLAY'

             EXPORTING

*       I_CALLBACK_PROGRAM       = '/PBS/CFI_LIS_REFERENCE' "PBSW070703

        I_CALLBACK_PROGRAM       = SYST-REPID               "PBSW070703

                I_STRUCTURE_NAME = 'XTAB'

                IT_FIELDCAT              = FIELDCAT

                I_SAVE                   = L_SAVE

                IS_VARIANT               = VARIANT

             IMPORTING                                       "PBSC060505

                ES_EXIT_CAUSED_BY_USER  = EXITUSER           "PBSC060505

             TABLES

                T_OUTTAB                 = XTAB

             EXCEPTIONS

                PROGRAM_ERROR            = 1

                OTHERS                   = 2.

     export exituser to memory id 'DEI_EXITUSER'.            "PBSC060505

     IF SY-SUBRC <> 0.

        MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO

                WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.

     ENDIF.

 

 

ENDIF.

ENDFORM.

 

FORM DEFINE_STRUCTURES_DISPLAY.

 

*------------- Vorbereitungen für ALV ----------------------------------

*------------------ Anzeigevarianten -----------------------------------

 

 

*-------------- Verschiedene Keys für die Aufrufe ----------------------

 

*----------------- Einstiegsvariante ermitteln -------------------------

IF 1 = 2.                                                  "PBSW240102

  CALL FUNCTION 'REUSE_ALV_VARIANT_DEFAULT_GET'

       EXPORTING

            I_SAVE        = 'X'

       CHANGING

            CS_VARIANT    = VARIANT

       EXCEPTIONS

            WRONG_INPUT   = 1

            NOT_FOUND     = 2

            PROGRAM_ERROR = 3

            OTHERS        = 4.

  IF SY-SUBRC NE 0.

    VARIANT-VARIANT = '/PBS/1SAP'.                         "PBSW221100

  ENDIF.

ENDIF.                                                     "PBSW240102

 

*------------------- Layout --------------------------------------------

  LAYOUT-ZEBRA           = 'X'.

  CLEAR LAYOUT-NO_MIN_LINESIZE.

  LAYOUT-MIN_LINESIZE    = '100'.

  LAYOUT-F2CODE          = 'DETA'.

  LAYOUT-KEY_HOTSPOT     = 'X'.

  LAYOUT-INFO_FIELDNAME  = 'COLOR'.

  LAYOUT-COLTAB_FIELDNAME = 'COLFW'.

*  LAYOUT-EXPAND_FIELDNAME = 'EXPAND'.

 

*------------------ Kopfanzeige und Fußzeile via Eventsteuerung --------

  REFRESH EVENTS.

  CLEAR EVENTS_WA.

  EVENTS_WA-NAME = 'END_OF_LIST'.

  EVENTS_WA-FORM = 'BELEGSALDO'.

  APPEND EVENTS_WA TO EVENTS.

ENDFORM.                               " DEFINE_STRUCTURES_CC_DISPLAY

FORM CHECK_LAYOUT_AUTH USING VALUE(P_INPUT)

                             P_OUTPUT.

  CASE P_INPUT.

    WHEN C_A OR C_X.

 

* Anfang                                           "PBSW291102

*      AUTHORITY-CHECK OBJECT 'F_IT_LAYO'

*                          ID 'ACTVT' FIELD '23'.

      AUTHORITY-CHECK OBJECT 'S_ALV_LAYO'

                          ID 'ACTVT' FIELD '23'.

* Ende                                            "PBSW291102

      IF SY-SUBRC = 0.

        P_OUTPUT = P_INPUT.

      ELSE.

        P_OUTPUT = C_U.

      ENDIF.

    WHEN OTHERS.

      P_OUTPUT = P_INPUT.

  ENDCASE.

ENDFORM.                               " CHECK_LAYOUT_AUTH

FORM PREPARE_LIST_DISPLAY.

  FIELDCAT_STRU[] = FIELDCAT[].

  LOOP AT FIELDCAT_STRU.

      IF FIELDCAT_STRU-NO_OUT NE 'X' AND FIELDCAT_STRU-TECH NE 'X'.

         IF FIELDCAT_STRU-TABNAME EQ 'XBSEG'.

            COLON_BSEG = COLON_BSEG + 1.

            IF COLON_BSEG > 75 .

               FIELDCAT_STRU-NO_OUT = 'X'.

               MODIFY FIELDCAT_STRU INDEX SY-TABIX

                                    TRANSPORTING NO_OUT.

            ENDIF.

*        Felder für BKPF rezervieren

         ELSEIF FIELDCAT_STRU-TABNAME EQ 'XBKPF'.

            COLON_BKPF = COLON_BKPF + 1.

            IF COLON_BKPF > 24 .

               FIELDCAT_STRU-NO_OUT = 'X'.

               MODIFY FIELDCAT_STRU INDEX SY-TABIX

                                    TRANSPORTING NO_OUT.

            ENDIF.

         ENDIF.

     ENDIF.

  ENDLOOP.

  FIELDCAT[] = FIELDCAT_STRU[].

 

  CLEAR GS_KEYINFO.

  GS_KEYINFO-HEADER01 = 'BUKRS'.

  GS_KEYINFO-ITEM01   = 'BUKRS'.

  GS_KEYINFO-HEADER02 = 'BELNR'.

  GS_KEYINFO-ITEM02   = 'BELNR'.

  GS_KEYINFO-HEADER03 = 'GJAHR'.

  GS_KEYINFO-ITEM03   = 'GJAHR'.

  GS_KEYINFO-ITEM04   = 'BUZEI'.

 

 

 

ENDFORM.

 

 

 

FORM ALV_VARIANT_F4_LIS CHANGING VARI_LIS.

  DATA: RS_VARIANT LIKE DISVARIANT.

 

  RS_VARIANT-REPORT   = SYST-REPID.

  RS_VARIANT-USERNAME = SY-UNAME.

  RS_VARIANT-HANDLE   = SPACE.

  CALL FUNCTION 'REUSE_ALV_VARIANT_F4'

       EXPORTING

            IS_VARIANT = RS_VARIANT

            I_SAVE     = 'A'

       IMPORTING

            ES_VARIANT = RS_VARIANT

       EXCEPTIONS

            OTHERS     = 1.

  IF SY-SUBRC = 0.

    VARI_LIS = RS_VARIANT-VARIANT.

  ENDIF.

ENDFORM.                               " ALV_VARIANT_F4

 

 

********************************************************************

*  FORM: outputStatistics

********************************************************************

*  PARAMETERS:

*    -

********************************************************************

*  gibt Statistiken des Exports auf dem Bildschirm aus

********************************************************************

FORM OUTPUTSTATISTICS.

  DATA: COLWIDTH TYPE I.

  DATA: POS TYPE I.

  DATA: POS2 TYPE I.

  DATA: ASTEXT TYPE CHAR20.

  DATA: FIRSTLINE TYPE I.

  DATA: NUMLINES TYPE I.

 

  WRITE: 'Exportprotokoll:  '(021), SY-DATUM, ' / ', SY-UZEIT.

  WRITE: SY-ULINE.

  perform write_content_info.

 

  WRITE: /, 'Ausgabepfad:  '(022), DIRNAME.

  WRITE: /, 'Ausgabedatei: '(023), DFNAME.

  WRITE: /, 'Anzahl geschriebener Debiposten:   '(024), 40 XTABCOUNT.

 

  WRITE: /, 'Anzahl geschriebener Posten:       '(027),

                                             40 NUMEXTRACTEDPOSITIONS.

 

 

ENDFORM.

 

form write_content_info.

tables: /PBS/CFI_AIS_CON.

data: x_text(132) type c.

select * from /PBS/cfi_ais_con where report eq syst-repid. "#EC CI_NOFIRST

  exit.

endselect.

x_text+00(30) = text-202.

x_text+30(40) = syst-repid.

condense x_text.

write: / x_text.

clear x_text.

skip 1.

x_text+00(30) = text-200.

x_text+30(40) = /pbs/cfi_ais_con-alias_stru.

condense x_text.

write: / x_text.

clear x_text.

skip 1.

x_text+00(30) = text-201.

x_text+30(50) = /PBS/CFI_AIS_CON-Beschreibung.

condense x_text.

write: / x_text.

endform.

 

 

 

FORM VERARBEITUNG.

IF EXP EQ SPACE.

  ADD 1 TO XTABCOUNT.

  APPEND XTAB.

  IF PA_NMAX > 0.

      DESCRIBE TABLE XTAB LINES N_LINES.

      IF PA_NMAX > 0 AND N_LINES GE PA_NMAX.

         P_STOP = 'X'.

         STOP.

      ENDIF.

  ENDIF.

 

ELSE.

 

    PERFORM GENXTABLINE IN PROGRAM (GENERATEDPROG) USING XTAB OUTLINE.

    PERFORM APPENDEXPORTFILE USING OUTLINE.

    PERFORM VERIFY_FILE_SIZE.                              "PBSW041102

 

  ADD 1 TO XTABCOUNT.

  IF SYST-BATCH EQ SPACE.                                  "PBSW181002

  IF PA_NMAX > 0.

      IF PA_NMAX > 0 AND XTABCOUNT GE PA_NMAX.

         P_STOP = 'X'.

         STOP.

      ENDIF.

  ENDIF.

  ENDIF.                                                   "PBSW181002

  ENDIF.

ENDFORM.

FORM GENERATE_VARIANT.

  DATA: S_FIELDCAT TYPE KKBLO_T_FIELDCAT.

  DATA: S_LAYOUT TYPE KKBLO_LAYOUT.

  MOVE-CORRESPONDING LAYOUT TO S_LAYOUT.

  CALL FUNCTION 'LT_VARIANT_LOAD'

           EXPORTING

                I_TABNAME           = EX_TABNAME

                I_DIALOG            = 'N'

                I_USER_SPECIFIC     = 'X'

            IMPORTING

                 ET_FIELDCAT         = S_FIELDCAT[]

           CHANGING

                CS_LAYOUT           = S_LAYOUT

                CT_DEFAULT_FIELDCAT = S_FIELDCAT

                CS_VARIANT          = VARIANT

           EXCEPTIONS

                WRONG_INPUT         = 1

                FC_NOT_COMPLETE     = 2

                NOT_FOUND           = 3

                OTHERS              = 4.

 

 

ENDFORM.

FORM DB_SELE.

* Anfang                                               "PBSW181002

* Tabellenselect.

*INCLUDE /PBS/CFI_LIS_T001_SEL.

SELECT * FROM T001

  WHERE

BUKRS IN SELOP001.                "#EC CI_NOORDER

MOVE-CORRESPONDING t001 to xtab.

 

  address_selection-addrnumber = t001-adrnr.    "SADR40A

  call function 'ADDR_GET'

       exporting

            address_selection = address_selection

            address_group     = 'CA01'

       importing

            address_value     = address_value

            sadr              = sadr

       exceptions

            others            = 1.

  if sy-subrc = 0.

    move-corresponding sadr to xtab.

* changes for note 1447179

* STRAS would contain only street data

* HOUSE_NUM would contain the house number

    xtab-name1     = address_value-name1.

    xtab-stras     = address_value-street.

    xtab-house_num = address_value-house_num1.

    xtab-ort01     = address_value-city1.

    xtab-ort02     = address_value-city2.

* end of changes for note 1447179

  endif.

 

 

 

PERFORM VERARBEITUNG.

ENDSELECT.

*INCLUDE /PBS/CFI_LIS_AIS_T009_SEL.

*INCLUDE /PBS/CFI_LIS_REFERENCE_SEL.

ENDFORM.

 

 

 

* Ende

 

 

* PBSY end

INCLUDE /PBS/UTIL_DEI_F01.                                 "PBSC060505

*Anfang                                                    "PBSW100707

*&---------------------------------------------------------------------*

*&      Form  authority_check_tab

*&---------------------------------------------------------------------*

FORM authority_check_tab  USING    TABLE

                                   SUBRC.

 

data: ls_tddat like tddat.

data: ls_dd02l like dd02l.

data: help_text(100) type c.

 

  select single * from dd02l into ls_dd02l

                             where tabname = table.

 

  SELECT SINGLE * FROM TDDAT into ls_tddat

                             WHERE TABNAME = table.

  IF SY-SUBRC <> 0  OR  ls_TDDAT-CCLASS = SPACE.

    ls_TDDAT-CCLASS = '&NC&'.             " 'non classified table'

  ENDIF.

 

* Anzeigeberechtigung

 

    AUTHORITY-CHECK OBJECT 'S_TABU_DIS'

             ID 'DICBERCLS' FIELD ls_TDDAT-CCLASS

             ID 'ACTVT' FIELD '03'.

    subrc = syst-subrc.

    IF SY-SUBRC NE 0.

      if syst-batch eq space.

         message e600(FR) with text-104 text-105 table.

         clear table.

      else.

      clear help_text.

      concatenate text-104 text-105 table

      into help_text separated by space.

      write: / help_text.

      endif.

    ENDIF.

ENDFORM.                    " authority_check_tab

*Ende                                                  "PBSW100707
